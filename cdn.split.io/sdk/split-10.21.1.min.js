/*! For license information please see split-10.21.1.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.splitio=t():e.splitio=t()}(self,(function(){return function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return Si}});var n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var o=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var o,a,u=s(e),c=1;c<arguments.length;c++){for(var l in o=Object(arguments[c]))r.call(o,l)&&(u[l]=o[l]);if(n){a=n(o);for(var f=0;f<a.length;f++)i.call(o,a[f])&&(u[a[f]]=o[a[f]])}}return u},a=223,u=315,c=318,l=319,f="Factory instantiation",h="Global fetch API is not available.",p="control",g={treatment:p,config:null},d="unknown",m="IMPRESSION",v="EVENT",y="DEBUG",b="OPTIMIZED",S="localhost",T="standalone",E="producer",w="consumer",_="consumer_partial",k="MEMORY",R="LOCALSTORAGE",C="GRANTED",A="DECLINED",N="UNKNOWN",O={headers:{"Cache-Control":"no-cache"}};function I(e){return"users="+encodeURIComponent(e)}function L(e,t,n){var r=e.urls,i=e.sync.__splitFiltersValidation&&e.sync.__splitFiltersValidation.queryString,s=e.sync.impressionsMode,a=function(e,t,n){var r=e.log,i=e.core.authorizationKey,s=e.version,a=e.runtime,u=a.ip,c=a.hostname,l=n&&n(),f=t&&t();f||r.error(303,[h]);var p={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+i,SplitSDKVersion:s};return u&&(p.SplitSDKMachineIP=u),c&&(p.SplitSDKMachineName=c),function(e,t,n,i){void 0===t&&(t={}),void 0===n&&(n=function(){}),void 0===i&&(i=!1);var s=o({headers:t.headers?o({},p,t.headers):p,method:t.method||"GET",body:t.body},l);return f?f(e,s).then((function(e){return e.ok?(n(),e):e.text().then((function(t){return Promise.reject({response:e,message:t})}))})).catch((function(t){var s,o=t&&t.response;s=o?404===o.status?"Invalid API key or resource not found.":t.message:t.message||"Network Error",o&&403===o.status||r[i?"info":"error"](322,[o?o.status:"NO_STATUS",e,s]);var a=new Error(s);throw a.statusCode=o&&o.status,n(a),a})):Promise.reject(new Error(h))}}(e,t.getFetch,t.getOptions);return{getSdkAPIHealthCheck:function(){var e=r.sdk+"/version";return a(e).then((function(){return!0})).catch((function(){return!1}))},getEventsAPIHealthCheck:function(){var e=r.events+"/version";return a(e).then((function(){return!0})).catch((function(){return!1}))},fetchAuth:function(e){var t=r.auth+"/v2/auth";if(e){var i=e.map(I).join("&");i&&(t+="?"+i)}return a(t,void 0,n.trackHttp("to"))},fetchSplitChanges:function(e,t,s){var o=r.sdk+"/splitChanges?since="+e+(s?"&till="+s:"")+(i||"");return a(o,t?O:void 0,n.trackHttp("sp"))},fetchSegmentChanges:function(e,t,i,s){var o=r.sdk+"/segmentChanges/"+t+"?since="+e+(s?"&till="+s:"");return a(o,i?O:void 0,n.trackHttp("se"))},fetchMySegments:function(e,t){var i=r.sdk+"/mySegments/"+encodeURIComponent(e);return a(i,t?O:void 0,n.trackHttp("ms"))},postEventsBulk:function(e,t){var i=r.events+"/events/bulk";return a(i,{method:"POST",body:e,headers:t},n.trackHttp("ev"))},postTestImpressionsBulk:function(e,t){var i=r.events+"/testImpressions/bulk";return a(i,{method:"POST",body:e,headers:o({SplitSDKImpressionsMode:s},t)},n.trackHttp("im"))},postTestImpressionsCount:function(e,t){var i=r.events+"/testImpressions/count";return a(i,{method:"POST",body:e,headers:t},n.trackHttp("ic"))},postMetricsConfig:function(e){var t=r.telemetry+"/v1/metrics/config";return a(t,{method:"POST",body:e},n.trackHttp("te"),!0)},postMetricsUsage:function(e){var t=r.telemetry+"/v1/metrics/usage";return a(t,{method:"POST",body:e},n.trackHttp("te"),!0)}}}function D(e,t,n,r){void 0===r&&(r="task");var i,s,o,a=0,u=!1,c=0;function l(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];return a++,e.debug(37,[r]),i=(i?i.then((function(){return t.apply(void 0,n)})):t.apply(void 0,n)).then((function(e){return a--,e}))}function f(e){return l.apply(void 0,s).then((function(t){return u&&e===c&&(o=setTimeout(f,n,e)),t}))}return{execute:l,isExecuting:function(){return a>0},start:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(!u)return u=!0,c++,s=t,e.debug(36,[r,n]),f(c)},stop:function(){u=!1,o&&(e.debug(38,[r]),clearTimeout(o),o=void 0)},isRunning:function(){return u}}}function M(e,t,n,r,i,s,o,a){void 0===o&&(o=0);var u,c=0;return D(e,(function(){if(n.isEmpty()&&!u)return Promise.resolve();var r="number"==typeof(u=n.pop(u)).length?u.length+" "+i:i;e[a?"debug":"info"](116,[r]);var l=JSON.stringify(s?s(u):u);return o||(u=void 0),t(l).then((function(){c=0,u=void 0})).catch((function(t){o?c===o?(c=0,u=void 0,e[a?"debug":"warn"](209,[r,t])):(c++,e[a?"debug":"warn"](210,[r,t])):e[a?"debug":"warn"](209,[r,t])}))}),r,i+" submitter")}function x(e,t){var n,r=!1,i=e.start;e.start=function(){r=!0,n=setTimeout(i,t)};var s=e.stop;return e.stop=function(){r=!1,clearTimeout(n),s()},e.isRunning=function(){return r},e}var F="events";function K(e){var t=e.settings,n=t.log,r=t.scheduler.eventsPushRate,i=t.startup.eventsFirstPushWindow,s=e.splitApi.postEventsBulk,o=e.storage.events,a=M(n,s,o,r,F);return i>0&&(a=x(a,i)),o.setOnFullQueueCb((function(){a.isRunning()&&(n.info(115,[F]),a.execute())})),a}var P=function(e,t){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},P(e,t)};function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}P(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function j(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function B(e,t){var n;if(V(e))for(var r=Object.keys(e),i=0;i<r.length&&!n;i++){var s=r[i];t(e[s],s,e)&&(n=e[s])}else if(Array.isArray(e))for(i=0;i<e.length&&!n;i++)t(e[i],i,e)&&(n=e[i]);return n}function G(e,t){if(Array.isArray(e)&&"function"==typeof t)for(var n=0;n<e.length;n++)if(!0===t(e[n],n,e))return n;return-1}function z(e,t){return Object.keys(e).forEach((function(n){return t(e[n],n,e)})),e}function q(e,t,n){var r=n;try{var i=t.split("."),s=e;i.forEach((function(e){return s=s[e]})),void 0!==s&&(r=s)}catch(e){}return r}function H(e){return!0===e||!1===e}function W(e){return e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&(Number.isFinite?Number.isFinite(e):isFinite(e))}function Q(e){return e instanceof Number&&(e=e.valueOf()),e!=e}function V(e){return null!==e&&"object"==typeof e&&(e.constructor===Object||null!=e.constructor&&"Object"===e.constructor.name)}function Y(e){return"string"==typeof e||e instanceof String}function J(e){return Y(e)?e.toUpperCase():e}function Z(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=e;if(V(t)&&Object.keys(t).forEach((function(e){var n=t[e];V(n)&&(n=i[e]&&V(i[e])?Z({},i[e],n):Z({},n)),void 0!==n&&(i[e]=n)})),n&&n.length){var s=n.splice(0,1)[0];i=Z.apply(void 0,j([i,s],n,!1))}return i}function $(e,t){return!(!Y(e)||!Y(t))&&e.slice(0,t.length)===t}function X(e){if("number"==typeof e)return e;if(V(e)&&"function"==typeof e.valueOf){var t=e.valueOf();e=V(t)?t+"":t}return"string"!=typeof e?0===e?e:+e:+(e=e.replace(/^\s+|\s+$/g,""))}function ee(e){if(null==e)return"";if("string"==typeof e)return e;if(Array.isArray(e))return e.map((function(e){return Y(e)?e:""}))+"";var t=e+"";return"0"===t&&1/e===Number.NEGATIVE_INFINITY?"-0":t}function te(e){var t={};return e.filter((function(e){return!Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=!0)}))}Object.create,Object.create;var ne="impressions";function re(e,t){var n=function(e,t){var n={};if(Array.isArray(e)&&Y(t))for(var r=0;r<e.length;r++){var i=e[r][t];Y(i)&&(n[i]||(n[i]=[]),n[i].push(e[r]))}return n}(t,"feature"),r=[];return z(n,(function(t,n){r.push({f:n,i:t.map((function(t){return{k:t.keyName,t:t.treatment,m:t.time,c:t.changeNumber,r:e?t.label:void 0,b:t.bucketingKey?t.bucketingKey:void 0,pt:t.pt?t.pt:void 0}}))})})),r}function ie(e){var t=e.settings,n=t.log,r=t.scheduler.impressionsRefreshRate,i=t.core.labelsEnabled,s=e.splitApi.postTestImpressionsBulk,o=e.storage.impressions,a=M(n,s,o,r,ne,re.bind(void 0,i),1);return o.setOnFullQueueCb((function(){a.isRunning()&&(n.info(115,[ne]),a.execute())})),a}function se(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var i=n[r].split("::");if(2===i.length){var s=i[0],o=i[1],a={f:s,m:Number(o),rc:e[n[r]]};t.push(a)}}return{pf:t}}var oe="state::splits-arrived",ae="state::splits-cache-loaded",ue="state::segments-arrived",ce="init::timeout",le="init::ready",fe="init::cache-ready",he="state::update",pe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function ge(e,t,n,r){if(void 0===r&&(r="split name"),null==t)e.error(u,[n,r]);else if(Y(t)){if(pe.test(t)&&(e.warn(214,[n,r,t]),t=t.trim()),t.length>0)return t;e.error(l,[n,r])}else e.error(c,[n,r]);return!1}function de(e,t,n,r,i){if(void 0===r&&(r="split_names"),void 0===i&&(i="split name"),Array.isArray(t)&&t.length>0){var s=[];if(t.forEach((function(t){var r=ge(e,t,n,i);r&&s.push(r)})),s.length)return te(s)}return e.error(320,[n,r]),!1}var me=[{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}];function ve(e,t,n,r){if(null==t)return e.error(u,[n,r]),!1;if(W(t))return e.warn(213,[n,r,t]),ee(t);if(Y(t)){if((t=t.trim()).length>0&&t.length<=250)return t;0===t.length?e.error(l,[n,r]):t.length>250&&e.error(316,[n,r])}else e.error(c,[n,r]);return!1}function ye(e,t,n){if(V(t)){var r=ve(e,t.matchingKey,n,"matchingKey"),i=ve(e,t.bucketingKey,n,"bucketingKey");return r&&i?{matchingKey:r,bucketingKey:i}:(e.error(317,[n]),!1)}return ve(e,t,n,"key")}var be=/[A-Z]/,Se="traffic_type";function Te(e,t,n){if(null==t)e.error(u,[n,Se]);else if(Y(t)){if(0!==t.length)return be.test(t)&&(e.warn(216,[n]),t=t.toLowerCase()),t;e.error(l,[n,Se])}else e.error(c,[n,Se]);return!1}var Ee={mode:T,core:{authorizationKey:void 0,key:void 0,trafficType:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:30,segmentsRefreshRate:60,telemetryRefreshRate:3600,impressionsRefreshRate:300,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,impressionsQueueSize:3e4,pushRetryBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io",telemetry:"https://telemetry.split.io/api"},storage:void 0,debug:void 0,impressionListener:void 0,version:void 0,integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0,impressionsMode:b,localhostMode:void 0,enabled:!0},log:void 0};function we(e){return Math.round(1e3*e)}function _e(e,t){var n=t.defaults,r=t.runtime,i=t.storage,s=t.integrations,o=t.logger,a=t.localhost,u=t.consent,c=Z({},Ee,n,e),l=o(c);c.log=l,c.sync.impressionsMode=function(e,t){return t=J(t),[y,b].indexOf(t)>-1?t:(e.error(321,["impressionsMode",[y,b],b]),b)}(l,c.sync.impressionsMode);var f,h=c.scheduler,p=c.startup;if(h.featuresRefreshRate=we(h.featuresRefreshRate),h.segmentsRefreshRate=we(h.segmentsRefreshRate),h.offlineRefreshRate=we(h.offlineRefreshRate),h.eventsPushRate=we(h.eventsPushRate),h.telemetryRefreshRate=we(("telemetryRefreshRate",(f=h.telemetryRefreshRate)>=60?f:(l.error(326,["telemetryRefreshRate",60]),60))),void 0===q(e,"scheduler.impressionsRefreshRate")&&c.sync.impressionsMode===y&&(h.impressionsRefreshRate=60),h.impressionsRefreshRate=we(h.impressionsRefreshRate),h.metricsRefreshRate&&l.warn("`metricsRefreshRate` will be deprecated soon. For configuring telemetry rates, update `telemetryRefreshRate` value in configs"),p.requestTimeoutBeforeReady=we(p.requestTimeoutBeforeReady),p.readyTimeout=we(p.readyTimeout),p.eventsFirstPushWindow=we(p.eventsFirstPushWindow),c.mode=function(e,t){if("localhost"===e)return S;if(-1===[T,E,w,_].indexOf(t))throw Error("Invalid mode provided");return t}(c.core.authorizationKey,c.mode),i&&(c.storage=i(c)),t.acceptKey){var g=c.core.key;if(c.mode===S&&void 0===g?c.core.key="localhost_key":c.core.key=ye(l,g,"Client instantiation"),t.acceptTT){var d=c.core.trafficType;void 0!==d&&(c.core.trafficType=Te(l,d,"Client instantiation"))}}c.runtime=r(c),s&&(c.integrations=s(c)),a&&(c.sync.localhostMode=a(c)),!1!==c.streamingEnabled&&(c.streamingEnabled=!0,h.pushRetryBackoffBase=we(h.pushRetryBackoffBase)),!1!==c.sync.enabled&&(c.sync.enabled=!0);var m=function(e,t,n){var r,i,s={validFilters:[],queryString:null,groupedFilters:{byName:[],byPrefix:[]}};return t?n!==T?(e.warn(219,[T]),s):Array.isArray(t)&&0!==t.length?(s.validFilters=t.filter((function(t,n){return t&&(r=t.type,me.some((function(e){return e.type===r})))&&Array.isArray(t.values)?(s.groupedFilters[t.type]=s.groupedFilters[t.type].concat(t.values),!0):(e.warn(220,[n]),!1);var r})),me.forEach((function(t){var n=t.type,r=t.maxLength;s.groupedFilters[n].length>0&&(s.groupedFilters[n]=function(e,t,n,r){var i=de(e,n,"settings",t+" filter",t+" filter value");if(i){if(i.length>r)throw new Error(r+" unique values can be specified at most for '"+t+"' filter. You passed "+i.length+". Please consider reducing the amount or using other filter.");i.sort()}return i||[]}(e,n,s.groupedFilters[n],r))})),s.queryString=(r=s.groupedFilters,i=[],me.forEach((function(e){var t=e.type,n=e.queryParam,s=r[t];s.length>0&&i.push(n+s.map((function(e){return encodeURIComponent(e)})).join(","))})),i.length>0?"&"+i.join("&"):null),e.debug(39,[s.queryString]),s):(e.warn(221),s):s}(l,c.sync.splitFilters,c.mode);return c.sync.splitFilters=m.validFilters,c.sync.__splitFiltersValidation=m,c.userConsent=u(c),c}var ke,Re,Ce,Ae="api_key",Ne={};function Oe(e){var t=e();return function(){return Math.round(e()-t)}}function Ie(e,t,n){return{isEmpty:function(){return!1},clear:function(){},pop:function(){return{lS:e.getLastSynchronization(),mL:e.popLatencies(),mE:e.popExceptions(),hE:e.popHttpErrors(),hL:e.popHttpLatencies(),tR:e.popTokenRefreshes(),aR:e.popAuthRejections(),iQ:e.getImpressionStats(0),iDe:e.getImpressionStats(2),iDr:e.getImpressionStats(1),spC:t.getSplitNames().length,seC:n.getRegisteredSegments().length,skC:n.getKeysCount(),sL:e.getSessionLength(),eQ:e.getEventStats(0),eD:e.getEventStats(1),sE:e.popStreamingEvents(),t:e.popTags()}}}}var Le=((ke={})[T]=0,ke[w]=1,ke[_]=2,ke),De=((Re={})[b]=0,Re[y]=1,Re),Me=((Ce={}).UNKNOWN=1,Ce.GRANTED=2,Ce.DECLINED=3,Ce);function xe(e){var t=[ie(e),K(e)],n=function(e){var t=e.settings.log,n=e.splitApi.postTestImpressionsCount,r=e.storage.impressionCounts;if(r)return M(t,n,r,18e5,"impression counts",se,1)}(e);n&&t.push(n);var r=function(e){var t=e.storage,n=t.splits,r=t.segments,i=t.telemetry,s=e.platform.now;if(i&&s){var a=e.settings,u=e.settings,c=u.log,l=u.scheduler.telemetryRefreshRate,f=e.splitApi,h=e.readiness,p=e.sdkReadinessManager,g=Oe(s),d=x(M(c,f.postMetricsUsage,Ie(i,n,r),l,"telemetry stats",void 0,0,!0),l);return h.gate.once(fe,(function(){i.recordTimeUntilReadyFromCache(g())})),p.incInternalReadyCbCount(),h.gate.once(le,(function(){i.recordTimeUntilReady(g()),d.isRunning()&&M(c,f.postMetricsConfig,function(e,t){return{isEmpty:function(){return!1},clear:function(){},pop:function(){var n,r,i=t.urls,s=t.scheduler,a=void 0!==t.core.key;return o((n=t.mode,r=t.storage.type,{oM:Le[n],st:r.toLowerCase(),aF:Object.keys(Ne).length,rF:Object.keys(Ne).reduce((function(e,t){return e+Ne[t]-1}),0)}),{sE:t.streamingEnabled,rR:{sp:s.featuresRefreshRate/1e3,se:a?void 0:s.segmentsRefreshRate/1e3,ms:a?s.segmentsRefreshRate/1e3:void 0,im:s.impressionsRefreshRate/1e3,ev:s.eventsPushRate/1e3,te:s.telemetryRefreshRate/1e3},uO:{s:i.sdk!==Ee.urls.sdk,e:i.events!==Ee.urls.events,a:i.auth!==Ee.urls.auth,st:i.streaming!==Ee.urls.streaming,t:i.telemetry!==Ee.urls.telemetry},iQ:s.impressionsQueueSize,eQ:s.eventsQueueSize,iM:De[t.sync.impressionsMode],iL:!!t.impressionListener,hP:!1,tR:e.getTimeUntilReady(),tC:e.getTimeUntilReadyFromCache(),nR:e.getNonReadyUsage(),t:e.popTags(),i:t.integrations&&t.integrations.map((function(e){return e.type})),uC:t.userConsent?Me[t.userConsent]:0})}}}(i,a),0,"telemetry config",void 0,0,!0).execute()})),d}}(e);return{start:function(e){e||t.forEach((function(e){return e.start()})),r&&r.start()},stop:function(e){t.forEach((function(e){return e.stop()})),!e&&r&&r.stop()},isRunning:function(){return t.some((function(e){return e.isRunning()}))},execute:function(e){var n=e?[]:t.map((function(e){return e.execute()}));return r&&n.push(r.execute()),Promise.all(n)},isExecuting:function(){return t.some((function(e){return e.isExecuting()}))}}}var Fe,Ke="PUSH_NONRETRYABLE_ERROR",Pe="PUSH_RETRYABLE_ERROR",Ue="PUSH_SUBSYSTEM_UP",je="PUSH_SUBSYSTEM_DOWN",Be="MY_SEGMENTS_UPDATE",Ge="MY_SEGMENTS_UPDATE_V2",ze="SEGMENT_UPDATE",qe="SPLIT_KILL",He="SPLIT_UPDATE",We="CONTROL",Qe="OCCUPANCY";function Ve(e){var t=e.userConsent;return!t||t===C}!function(e){e.STREAMING_DISABLED="STREAMING_DISABLED",e.STREAMING_PAUSED="STREAMING_PAUSED",e.STREAMING_RESUMED="STREAMING_RESUMED",e.STREAMING_RESET="STREAMING_RESET"}(Fe||(Fe={}));var Ye=function(){function e(t,n,r){this.baseMillis=e.__TEST__BASE_MILLIS||n||e.DEFAULT_BASE_MILLIS,this.maxMillis=e.__TEST__MAX_MILLIS||r||e.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=t}return e.prototype.scheduleCall=function(){var e=this,t=Math.min(this.baseMillis*Math.pow(2,this.attempts),this.maxMillis);return this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){e.timeoutID=void 0,e.cb()}),t),this.attempts++,t},e.prototype.reset=function(){this.attempts=0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=void 0)},e.DEFAULT_BASE_MILLIS=1e3,e.DEFAULT_MAX_MILLIS=18e5,e}(),Je=[/control_pri$/,/control_sec$/],Ze=[10,20];function $e(e){var t,n,r=0,i=-1,s=!1,o=new Ye(a);function a(){if(t=!0,r>i){s=!1;var u=r;e.execute(n,!0).then((function(e){t&&(!1!==e&&(i=Math.max(i,u)),s?a():o.scheduleCall())}))}else t=!1}return{put:function(e,u){e<=i||e<=r||(r=e,s=!0,n=u,!o.timeoutID&&t||a(),o.reset())},stop:function(){t=!1,o.reset()}}}var Xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function et(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var n="",r=0,i=void 0,s=void 0,o=0;s=t.charAt(o++);~s&&(i=r%4?64*i+s:s,r++%4)?n+=String.fromCharCode(255&i>>(-2*r&6)):0)s=Xe.indexOf(s);return n}var tt=String.fromCharCode;function nt(e){var t,n,r,i,s;return n=function(e){if("string"!=typeof e)throw TypeError("Illegal argument: "+typeof e);var t=0;return function(){return t>=e.length?null:e.charCodeAt(t++)}}(e),i=[],s=[],r=t=function(){if(0===arguments.length)return s.join("")+tt.apply(String,i);i.length+arguments.length>1024&&(s.push(tt.apply(String,i)),i.length=0),Array.prototype.push.apply(i,arguments)},function(e,t){for(var n,r=null;null!==(n=null!==r?r:e());)n>=55296&&n<=57343&&null!==(r=e())&&r>=56320&&r<=57343?(t(1024*(n-55296)+r-56320+65536),r=null):t(n);null!==r&&t(r)}(n,(function(e){!function(e,t){var n=null;for("number"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<128?t(127&n):n<2048?(t(n>>6&31|192),t(63&n|128)):n<65536?(t(n>>12&15|224),t(n>>6&63|128),t(63&n|128)):(t(n>>18&7|240),t(n>>12&63|128),t(n>>6&63|128),t(63&n|128)),n=null}(e,r)})),t()}function rt(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function it(e,t){return e<<t|e>>>32-t}function st(e,t){return function(e,t){t=t||0;for(var n,r=(e=e||"").length%4,i=e.length-r,s=t,o=0,a=3432918353,u=461845907,c=0;c<i;c+=4)o=rt(o=255&e.charCodeAt(c)|(255&e.charCodeAt(c+1))<<8|(255&e.charCodeAt(c+2))<<16|(255&e.charCodeAt(c+3))<<24,a),o=rt(o=it(o,15),u),s=rt(s=it(s^=o,13),5)+3864292196;switch(o=0,r){case 3:o^=(255&e.charCodeAt(c+2))<<16;case 2:o^=(255&e.charCodeAt(c+1))<<8;case 1:o=rt(o^=255&e.charCodeAt(c),a),s^=o=rt(o=it(o,15),u)}return n=s^=e.length,n=rt(n^=n>>>16,2246822507),(s=(n=rt(n^=n>>>13,3266489909))^n>>>16)>>>0}(nt(e),t>>>0)}function ot(e,t){return Math.abs(st(e,t)%100)+1}function at(e){return function(e){for(var t=String(e),n="",r=void 0,i=void 0,s=0,o=Xe;t.charAt(0|s)||(o="=",s%1);n+=o.charAt(63&r>>8-s%1*8)){if((i=t.charCodeAt(s+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|i}return n}(st(e,0).toString())}var ut,ct,lt=/^control_/,ft=function(){function e(e,t,n){if(this.eventSource=n&&n(),!this.eventSource)throw new Error("EventSource API is not available. ");this.streamingUrl=e.urls.streaming+"/sse",this.useHeaders=t,this.headers=function(e){var t={SplitSDKClientKey:Y(e.core.authorizationKey)?e.core.authorizationKey.slice(-4):"",SplitSDKVersion:e.version},n=e.runtime,r=n.ip,i=n.hostname;return r&&(t.SplitSDKMachineIP=r),i&&(t.SplitSDKMachineName=i),t}(e)}return e.prototype.setEventHandler=function(e){this.handler=e},e.prototype.open=function(e){this.close();var t=Object.keys(e.channels).map((function(e){var t=lt.test(e)?"[?occupancy=metrics.publishers]":"";return encodeURIComponent(t+e)})).join(","),n=this.streamingUrl+"?channels="+t+"&accessToken="+e.token+"&v=1.1&heartbeats=true";this.connection=new this.eventSource(this.useHeaders?n:n+"&SplitSDKVersion="+this.headers.SplitSDKVersion+"&SplitSDKClientKey="+this.headers.SplitSDKClientKey,this.useHeaders?{headers:this.headers}:void 0),this.handler&&(this.connection.addEventListener("open",this.handler.handleOpen),this.connection.addEventListener("message",this.handler.handleMessage),this.connection.addEventListener("error",this.handler.handleError))},e.prototype.close=function(){this.connection&&this.connection.close()},e}();function ht(e){return V(e)?e.matchingKey:e}function pt(e){return V(e)?{matchingKey:e.matchingKey,bucketingKey:e.bucketingKey}:{matchingKey:e,bucketingKey:e}}!function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zlib=2]="Zlib"}(ut||(ut={})),function(e){e[e.UnboundedFetchRequest=0]="UnboundedFetchRequest",e[e.BoundedFetchRequest=1]="BoundedFetchRequest",e[e.KeyList=2]="KeyList",e[e.SegmentRemoval=3]="SegmentRemoval"}(ct||(ct={}));var gt=function(){if([typeof Uint8Array,typeof Uint16Array,typeof Uint32Array].some((function(e){return"function"!=e})))return"global Uint8Array object is not available for gzip/zlib decompression";var e=Uint8Array,t=Uint16Array,n=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(e,r){for(var i=new t(31),s=0;s<31;++s)i[s]=r+=1<<e[s-1];var o=new n(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)o[a]=a-i[s]<<5|s;return[i,o]},a=o(r,2),u=a[0],c=a[1];u[28]=258,c[258]=28;for(var l=o(i,0)[0],f=new t(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,f[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var g=function(e,n,r){for(var i=e.length,s=0,o=new t(n);s<i;++s)++o[e[s]-1];var a,u=new t(n);for(s=0;s<n;++s)u[s]=u[s-1]+o[s-1]<<1;if(r){a=new t(1<<n);var c=15-n;for(s=0;s<i;++s)if(e[s])for(var l=s<<4|e[s],h=n-e[s],p=u[e[s]-1]++<<h,g=p|(1<<h)-1;p<=g;++p)a[f[p]>>>c]=l}else for(a=new t(i),s=0;s<i;++s)e[s]&&(a[s]=f[u[e[s]-1]++]>>>15-e[s]);return a},d=new e(288);for(h=0;h<144;++h)d[h]=8;for(h=144;h<256;++h)d[h]=9;for(h=256;h<280;++h)d[h]=7;for(h=280;h<288;++h)d[h]=8;var m=new e(32);for(h=0;h<32;++h)m[h]=5;var v=g(d,9,1),y=g(m,5,1),b=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},S=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},T=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],w=function(e,t,n){var r=new Error(t||E[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,w),!n)throw r;return r},_=function(o,a,c){var f=o.length;if(!f||c&&c.f&&!c.l)return a||new e(0);var h=!a||c,p=!c||c.i;c||(c={}),a||(a=new e(3*f));var d=function(t){var n=a.length;if(t>n){var r=new e(Math.max(2*n,t));r.set(a),a=r}},m=c.f||0,E=c.p||0,_=c.b||0,k=c.l,R=c.d,C=c.m,A=c.n,N=8*f;do{if(!k){m=S(o,E,1);var O=S(o,E+1,3);if(E+=3,!O){var I=o[(G=4+((E+7)/8|0))-4]|o[G-3]<<8,L=G+I;if(L>f){p&&w(0);break}h&&d(_+I),a.set(o.subarray(G,L),_),c.b=_+=I,c.p=E=8*L,c.f=m;continue}if(1==O)k=v,R=y,C=9,A=5;else if(2==O){var D=S(o,E,31)+257,M=S(o,E+10,15)+4,x=D+S(o,E+5,31)+1;E+=14;for(var F=new e(x),K=new e(19),P=0;P<M;++P)K[s[P]]=S(o,E+3*P,7);E+=3*M;var U=b(K),j=(1<<U)-1,B=g(K,U,1);for(P=0;P<x;){var G,z=B[S(o,E,j)];if(E+=15&z,(G=z>>>4)<16)F[P++]=G;else{var q=0,H=0;for(16==G?(H=3+S(o,E,3),E+=2,q=F[P-1]):17==G?(H=3+S(o,E,7),E+=3):18==G&&(H=11+S(o,E,127),E+=7);H--;)F[P++]=q}}var W=F.subarray(0,D),Q=F.subarray(D);C=b(W),A=b(Q),k=g(W,C,1),R=g(Q,A,1)}else w(1);if(E>N){p&&w(0);break}}h&&d(_+131072);for(var V=(1<<C)-1,Y=(1<<A)-1,J=E;;J=E){var Z=(q=k[T(o,E)&V])>>>4;if((E+=15&q)>N){p&&w(0);break}if(q||w(2),Z<256)a[_++]=Z;else{if(256==Z){J=E,k=null;break}var $=Z-254;if(Z>264){var X=r[P=Z-257];$=S(o,E,(1<<X)-1)+u[P],E+=X}var ee=R[T(o,E)&Y],te=ee>>>4;if(ee||w(3),E+=15&ee,Q=l[te],te>3&&(X=i[te],Q+=T(o,E)&(1<<X)-1,E+=X),E>N){p&&w(0);break}h&&d(_+131072);for(var ne=_+$;_<ne;_+=4)a[_]=a[_-Q],a[_+1]=a[_+1-Q],a[_+2]=a[_+2-Q],a[_+3]=a[_+3-Q];_=ne}}c.l=k,c.p=J,c.b=_,c.f=m,k&&(m=1,c.m=C,c.d=R,c.n=A)}while(!m);return _==a.length?a:function(r,i,s){(null==i||i<0)&&(i=0),(null==s||s>r.length)&&(s=r.length);var o=new(r instanceof t?t:r instanceof n?n:e)(s-i);return o.set(r.subarray(i,s)),o}(a,0,_)};return{gunzipSync:function(t,n){return _(t.subarray(function(e){31==e[0]&&139==e[1]&&8==e[2]||w(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)}(t),-8),n||new e((i=(r=t).length,(r[i-4]|r[i-3]<<8|r[i-2]<<16|r[i-1]<<24)>>>0)));var r,i},unzlibSync:function(e,t){return _(((8!=(15&(n=e)[0])||n[0]>>>4>7||(n[0]<<8|n[1])%31)&&w(6,"invalid zlib data"),32&n[1]&&w(6,"invalid zlib data: preset dictionaries not supported"),e.subarray(2,-4)),t);var n}}}();function dt(e,t){var n,r=(n=et(e).split("").map((function(e){return e.charCodeAt(0)})),new Uint8Array(n));if("string"==typeof gt)throw new Error(gt);if(1===t)return gt.gunzipSync(r);if(2===t)return gt.unzlibSync(r);throw new Error("Invalid compression algorithm #"+t)}var mt=function(){function e(e){var t=this;this.__setData__=[],Array.isArray(e)&&e.forEach((function(e){t.add(e)}))}return e.prototype.clear=function(){this.__setData__.length&&(this.__setData__.length=0)},e.prototype.add=function(e){return this.has(e)||this.__setData__.push(e),this},e.prototype.delete=function(e){var t=this.__setData__.indexOf(e);return-1!==t&&(this.__setData__.splice(t,1),!0)},e.prototype.has=function(e){return-1!==this.__setData__.indexOf(e)},e.prototype.forEach=function(e,t){if("function"!=typeof e)throw new TypeError(e+" is not a function");for(var n=0;n<this.__setData__.length;n++){var r=this.__setData__[n];e.call(t,r,r,this)}},Object.defineProperty(e.prototype,"size",{get:function(){return this.__setData__.length},enumerable:!1,configurable:!0}),e}();function vt(e){return e instanceof mt?e.__setData__.slice():Array.from(e)}var yt="function"==typeof Array.from&&"function"==typeof Set&&Set.prototype&&Set.prototype.values?Set:mt;function bt(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function St(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function Tt(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function Et(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function wt(e,t){return[e[0]^t[0],e[1]^t[1]]}function _t(e){return e=wt(e,[0,e[0]>>>1]),e=wt(e=St(e,[4283543511,3981806797]),[0,e[0]>>>1]),wt(e=St(e,[3301882366,444984403]),[0,e[0]>>>1])}function kt(e,t){return function(e,t){t=t||0;for(var n=(e=e||"").length%16,r=e.length-n,i=[0,t],s=[0,t],o=[0,0],a=[0,0],u=[2277735313,289559509],c=[1291169091,658871167],l=0;l<r;l+=16)o=[255&e.charCodeAt(l+4)|(255&e.charCodeAt(l+5))<<8|(255&e.charCodeAt(l+6))<<16|(255&e.charCodeAt(l+7))<<24,255&e.charCodeAt(l)|(255&e.charCodeAt(l+1))<<8|(255&e.charCodeAt(l+2))<<16|(255&e.charCodeAt(l+3))<<24],a=[255&e.charCodeAt(l+12)|(255&e.charCodeAt(l+13))<<8|(255&e.charCodeAt(l+14))<<16|(255&e.charCodeAt(l+15))<<24,255&e.charCodeAt(l+8)|(255&e.charCodeAt(l+9))<<8|(255&e.charCodeAt(l+10))<<16|(255&e.charCodeAt(l+11))<<24],o=Tt(o=St(o,u),31),i=bt(i=Tt(i=wt(i,o=St(o,c)),27),s),i=bt(St(i,[0,5]),[0,1390208809]),a=Tt(a=St(a,c),33),s=bt(s=Tt(s=wt(s,a=St(a,u)),31),i),s=bt(St(s,[0,5]),[0,944331445]);switch(o=[0,0],a=[0,0],n){case 15:a=wt(a,Et([0,e.charCodeAt(l+14)],48));case 14:a=wt(a,Et([0,e.charCodeAt(l+13)],40));case 13:a=wt(a,Et([0,e.charCodeAt(l+12)],32));case 12:a=wt(a,Et([0,e.charCodeAt(l+11)],24));case 11:a=wt(a,Et([0,e.charCodeAt(l+10)],16));case 10:a=wt(a,Et([0,e.charCodeAt(l+9)],8));case 9:a=St(a=wt(a,[0,e.charCodeAt(l+8)]),c),s=wt(s,a=St(a=Tt(a,33),u));case 8:o=wt(o,Et([0,e.charCodeAt(l+7)],56));case 7:o=wt(o,Et([0,e.charCodeAt(l+6)],48));case 6:o=wt(o,Et([0,e.charCodeAt(l+5)],40));case 5:o=wt(o,Et([0,e.charCodeAt(l+4)],32));case 4:o=wt(o,Et([0,e.charCodeAt(l+3)],24));case 3:o=wt(o,Et([0,e.charCodeAt(l+2)],16));case 2:o=wt(o,Et([0,e.charCodeAt(l+1)],8));case 1:o=St(o=wt(o,[0,e.charCodeAt(l)]),u),i=wt(i,o=St(o=Tt(o,31),c))}return i=bt(i=wt(i,[0,e.length]),s=wt(s,[0,e.length])),s=bt(s,i),i=bt(i=_t(i),s=_t(s)),s=bt(s,i),("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)+("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)}(nt(e),t>>>0)}function Rt(e){var t,n,r,i=[0];for(t=0;t<e.length;t+=1){for(r=parseInt(e.charAt(t),16),n=i.length-1;n>=0;n-=1)i[n]=16*i[n]+r,r=i[n]/10|0,i[n]%=10;for(;r>0;)i.unshift(r%10),r=r/10|0}return i.join("")}function Ct(e,t){return e<1?t:new Promise((function(n,r){var i=setTimeout((function(){r(new Error("Operation timed out because it exceeded the configured time limit of "+e+" ms."))}),e);t.then((function(e){clearTimeout(i),n(e)}),(function(e){clearTimeout(i),r(e)}))}))}function At(e,t,n,r,i,s,o,a){var u=!0,c=!0;function l(e){return c&&(e=Ct(s,e)),e}function f(e){var t;if(Array.isArray(e))t=r.resetSegments(e);else{var s=e.name,o=e.add;r.isInSegment(s)!==o?(t=!0,o?r.addToSegment(s):r.removeFromSegment(s)):t=!1}n.usesSegments()&&(t||u)&&(u=!1,i.emit(ue))}function h(n,r,i){return(r?new Promise((function(e){f(r),e(!0)})):t(a,i,l).then((function(e){return c=!1,f(e),!0}))).catch((function(t){return c&&o>n?(n+=1,e.warn(204,[n,t]),h(n)):(c=!1,!1)}))}return function(e,t){return h(0,e,t)}}function Nt(e,t,n,r,i,s,o,a){void 0===s&&(s=0),void 0===o&&(o=0);var u=!0;function c(e){return u&&s&&(e=Ct(s,e)),e}return function(s,l){return Promise.resolve(n.getChangeNumber()).then((function f(h,p){void 0===p&&(p=0),e.debug(31,[h]);var g=t(h,s,l,c).then((function(t){u=!1;var s=function(e){var t=new yt,n=e.reduce((function(e,n){return"ACTIVE"===n.status?(e.added.push([n.name,JSON.stringify(n)]),function(e){for(var t=e.conditions,n=new yt,r=0;r<t.length;r++)t[r].matcherGroup.matchers.forEach((function(e){"IN_SEGMENT"===e.matcherType&&n.add(e.userDefinedSegmentMatcherData.segmentName)}));return n}(n).forEach((function(e){t.add(e)}))):e.removed.push(n.name),e}),{added:[],removed:[],segments:[]});return n.segments=vt(t),n}(t.splits);return e.debug(32,[s.added.length]),e.debug(33,[s.removed.length]),e.debug(34,[s.segments.length]),Promise.all([n.setChangeNumber(t.till),n.addSplits(s.added),n.removeSplits(s.removed),r.registerSegments(s.segments)]).then((function(){return!i||Promise.resolve(!i.splitsArrived||h!==t.till&&(a||function(e){return Promise.resolve(e.getRegisteredSegments()).then((function(t){return Promise.all(t.map((function(t){return e.getChangeNumber(t)}))).then((function(e){return e.every((function(e){return-1!==e}))}))}))}(r))).catch((function(){return!1})).then((function(e){return e&&i.emit(oe),!0}))}))})).catch((function(t){return e.warn(205,[t]),u&&o>p?(p+=1,e.info(109,[p,t]),f(h,p)):(u=!1,!1)}));return i&&u&&Promise.resolve(n.checkCache()).then((function(e){e&&i.emit(ae)})),g}))}}var Ot=function(){function e(e){void 0===e&&(e=0),this.maxQueue=e,this.queue=[]}return e.prototype.setOnFullQueueCb=function(e){this.onFullQueue=e},e.prototype.track=function(e){var t;(t=this.queue).push.apply(t,e),this.maxQueue>0&&this.queue.length>=this.maxQueue&&this.onFullQueue&&this.onFullQueue()},e.prototype.clear=function(){this.queue=[]},e.prototype.pop=function(e){var t=this.queue;return this.clear(),e?e.concat(t):t},e.prototype.isEmpty=function(){return 0===this.queue.length},e}();function It(e){return e-e%36e5}var Lt=function(){function e(){this.cache={}}return e.prototype._makeKey=function(e,t){return e+"::"+It(t)},e.prototype.track=function(e,t,n){var r=this._makeKey(e,t),i=this.cache[r];this.cache[r]=i?i+n:n},e.prototype.pop=function(e){var t=this.cache;return this.clear(),e?(Object.keys(t).forEach((function(n){e[n]?e[n]+=t[n]:e[n]=t[n]})),e):t},e.prototype.clear=function(){this.cache={}},e.prototype.isEmpty=function(){return 0===Object.keys(this.cache).length},e}(),Dt=function(){function e(e){void 0===e&&(e=0),this.maxQueue=e,this.queue=[],this.queueByteSize=0}return e.prototype.setOnFullQueueCb=function(e){this.onFullQueue=e},e.prototype.track=function(e,t){return void 0===t&&(t=0),this.queueByteSize+=t,this.queue.push(e),this._checkForFlush(),!0},e.prototype.clear=function(){this.queue=[],this.queueByteSize=0},e.prototype.pop=function(e){var t=this.queue;return this.clear(),e?e.concat(t):t},e.prototype.isEmpty=function(){return 0===this.queue.length},e.prototype._checkForFlush=function(){(this.queueByteSize>5242880||this.maxQueue>0&&this.queue.length>=this.maxQueue)&&this.onFullQueue&&this.onFullQueue()},e}(),Mt=/[^.]+$/,xt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.matchingKey=n,r.regexSplitsCacheKey=new RegExp("^"+t+"\\.(splits?|trafficType)\\."),r}return U(t,e),t.prototype.buildSegmentNameKey=function(e){return this.prefix+"."+this.matchingKey+".segment."+e},t.prototype.extractSegmentName=function(e){var t=this.prefix+"."+this.matchingKey+".segment.";if($(e,t))return e.substr(t.length)},t.prototype.buildOldSegmentNameKey=function(e){return this.matchingKey+"."+this.prefix+".segment."+e},t.prototype.extractOldSegmentKey=function(e){var t=this.matchingKey+"."+this.prefix+".segment.";if($(e,t))return e.substr(t.length)},t.prototype.buildLastUpdatedKey=function(){return this.prefix+".splits.lastUpdated"},t.prototype.isSplitsCacheKey=function(e){return this.regexSplitsCacheKey.test(e)},t.prototype.buildSplitsFilterQueryKey=function(){return this.prefix+".splits.filterQuery"},t}(function(){function e(e){void 0===e&&(e="SPLITIO"),this.prefix=e}return e.prototype.buildTrafficTypeKey=function(e){return this.prefix+".trafficType."+e},e.prototype.buildSplitKey=function(e){return this.prefix+".split."+e},e.prototype.buildSplitsTillKey=function(){return this.prefix+".splits.till"},e.prototype.isSplitKey=function(e){return $(e,this.prefix+".split.")},e.prototype.buildSplitKeyPrefix=function(){return this.prefix+".split."},e.prototype.buildSplitsWithSegmentCountKey=function(){return this.prefix+".splits.usingSegments"},e.prototype.buildSegmentNameKey=function(e){return this.prefix+".segment."+e},e.prototype.buildSegmentTillKey=function(e){return this.prefix+".segment."+e+".till"},e.prototype.extractKey=function(e){var t=e.match(Mt);if(t&&t.length)return t[0];throw new Error("Invalid latency key provided")},e}());function Ft(){var e="__SPLITSOFTWARE__";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}var Kt=function(){function e(){}return e.prototype.addSplits=function(e){var t=this;return e.map((function(e){return t.addSplit(e[0],e[1])}))},e.prototype.removeSplits=function(e){var t=this;return e.map((function(e){return t.removeSplit(e)}))},e.prototype.getSplits=function(e){var t=this,n={};return e.forEach((function(e){n[e]=t.getSplit(e)})),n},e.prototype.getAll=function(){var e=this;return this.getSplitNames().map((function(t){return e.getSplit(t)}))},e.prototype.checkCache=function(){return!1},e.prototype.killLocally=function(e,t,n){var r=this.getSplit(e);if(r){var i=JSON.parse(r);if(!i.changeNumber||i.changeNumber<n){i.killed=!0,i.defaultTreatment=t,i.changeNumber=n;var s=JSON.stringify(i);return this.addSplit(e,s)}}return!1},e}();function Pt(e){for(var t=e.conditions||[],n=0;n<t.length;n++)for(var r=t[n].matcherGroup.matchers,i=0;i<r.length;i++)if("IN_SEGMENT"===r[i].matcherType)return!0;return!1}var Ut="storage:localstorage: ",jt=function(e){function t(t,n,r,i){void 0===i&&(i={queryString:null,groupedFilters:{byName:[],byPrefix:[]},validFilters:[]});var s=e.call(this)||this;return s.log=t,s.cacheReadyButNeedsToFlush=!1,s.keys=n,s.splitFiltersValidation=i,s._checkExpiration(r),s._checkFilterQuery(),s}return U(t,e),t.prototype._decrementCount=function(e){var t=X(localStorage.getItem(e))-1;t>0?localStorage.setItem(e,t):localStorage.removeItem(e)},t.prototype._decrementCounts=function(e){try{if(e){if(e.trafficTypeName){var t=this.keys.buildTrafficTypeKey(e.trafficTypeName);this._decrementCount(t)}if(Pt(e)){var n=this.keys.buildSplitsWithSegmentCountKey();this._decrementCount(n)}}}catch(e){this.log.error(Ut+e)}},t.prototype._incrementCounts=function(e){try{if(e){if(e.trafficTypeName){var t=this.keys.buildTrafficTypeKey(e.trafficTypeName);localStorage.setItem(t,X(localStorage.getItem(t))+1)}if(Pt(e)){var n=this.keys.buildSplitsWithSegmentCountKey();localStorage.setItem(n,X(localStorage.getItem(n))+1)}}}catch(e){this.log.error(Ut+e)}},t.prototype.clear=function(){this.log.info(Ut+"Flushing Splits data from localStorage");for(var e=localStorage.length,t=[],n=0;n<e;n++){var r=localStorage.key(n);null!=r&&this.keys.isSplitsCacheKey(r)&&t.push(r)}t.forEach((function(e){localStorage.removeItem(e)})),this.hasSync=!1},t.prototype.addSplit=function(e,t){try{var n=this.keys.buildSplitKey(e),r=localStorage.getItem(n),i=r?JSON.parse(r):null;this._decrementCounts(i),localStorage.setItem(n,t);var s=t?JSON.parse(t):null;return this._incrementCounts(s),!0}catch(e){return this.log.error(Ut+e),!1}},t.prototype.removeSplit=function(e){try{var t=this.getSplit(e);localStorage.removeItem(this.keys.buildSplitKey(e));var n=JSON.parse(t);return this._decrementCounts(n),!0}catch(e){return this.log.error(Ut+e),!1}},t.prototype.getSplit=function(e){return localStorage.getItem(this.keys.buildSplitKey(e))},t.prototype.setChangeNumber=function(e){if(this.cacheReadyButNeedsToFlush&&(this.clear(),this.cacheReadyButNeedsToFlush=!1),this.updateNewFilter){this.log.info(Ut+"Split filter query was modified. Updating cache.");var t=this.keys.buildSplitsFilterQueryKey(),n=this.splitFiltersValidation.queryString;try{n?localStorage.setItem(t,n):localStorage.removeItem(t)}catch(e){this.log.error(Ut+e)}this.updateNewFilter=!1}try{return localStorage.setItem(this.keys.buildSplitsTillKey(),e+""),localStorage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0,!0}catch(e){return this.log.error(Ut+e),!1}},t.prototype.getChangeNumber=function(){var e=localStorage.getItem(this.keys.buildSplitsTillKey());return null!==e?Q(e=parseInt(e,10))?-1:e:-1},t.prototype.getSplitNames=function(){for(var e=localStorage.length,t=[],n=0;n<e;){var r=localStorage.key(n);null!=r&&this.keys.isSplitKey(r)&&t.push(this.keys.extractKey(r)),n++}return t},t.prototype.trafficTypeExists=function(e){var t=X(localStorage.getItem(this.keys.buildTrafficTypeKey(e)));return W(t)&&t>0},t.prototype.usesSegments=function(){if(!this.hasSync)return!0;var e=localStorage.getItem(this.keys.buildSplitsWithSegmentCountKey()),t=null===e?0:X(e);return!W(t)||t>0},t.prototype.checkCache=function(){return this.getChangeNumber()>-1||this.cacheReadyButNeedsToFlush},t.prototype._checkExpiration=function(e){var t=localStorage.getItem(this.keys.buildLastUpdatedKey());null!==t&&!Q(t=parseInt(t,10))&&e&&t<e&&this.clear()},t.prototype._checkFilterQuery=function(){var e=this,t=this.splitFiltersValidation,n=t.queryString,r=t.groupedFilters,i=this.keys.buildSplitsFilterQueryKey();if(localStorage.getItem(i)!==n)try{this.updateNewFilter=!0,this.checkCache()&&(localStorage.setItem(this.keys.buildSplitsTillKey(),"-1"),this.getSplitNames().forEach((function(t){n&&(r.byName.indexOf(t)>-1||r.byPrefix.some((function(e){return t.startsWith(e+"__")})))?e.cacheReadyButNeedsToFlush=!0:e.removeSplit(t)})))}catch(e){this.log.error(Ut+e)}},t}(Kt),Bt=function(){function e(){}return e.prototype.registerSegments=function(e){return!1},e.prototype.setChangeNumber=function(e,t){return!0},e.prototype.getChangeNumber=function(e){return-1},e.prototype.resetSegments=function(e){return!0},e}(),Gt=function(e){function t(t,n){var r=e.call(this)||this;return r.log=t,r.keys=n,r}return U(t,e),t.prototype.clear=function(){this.log.info(Ut+"Flushing MySegments data from localStorage"),this.resetSegments([])},t.prototype.addToSegment=function(e){var t=this.keys.buildSegmentNameKey(e);try{return localStorage.setItem(t,"1"),!0}catch(e){return this.log.error(Ut+e),!1}},t.prototype.removeFromSegment=function(e){var t=this.keys.buildSegmentNameKey(e);try{return localStorage.removeItem(t),!0}catch(e){return this.log.error(Ut+e),!1}},t.prototype.isInSegment=function(e){return"1"===localStorage.getItem(this.keys.buildSegmentNameKey(e))},t.prototype.resetSegments=function(e){var t,n=this,r=!1,i=Object.keys(localStorage).reduce((function(t,r){var i=n.keys.extractSegmentName(r);if(i)t.push(i);else if(i=n.keys.extractOldSegmentKey(r)){var s=n.keys.buildSegmentNameKey(i);try{!localStorage.getItem(s)&&e.indexOf(i)>-1&&(localStorage.setItem(s,"1"),t.push(i)),localStorage.removeItem(r)}catch(e){n.log.error(e)}}return t}),[]);if(0===e.length&&i.length===e.length)return r;if(i.length!==e.length)r=!0,i.forEach((function(e){return n.removeFromSegment(e)})),e.forEach((function(e){return n.addToSegment(e)}));else{for(t=0;t<e.length&&-1!==i.indexOf(e[t]);t++);t<e.length&&(r=!0,i.forEach((function(e){return n.removeFromSegment(e)})),e.forEach((function(e){return n.addToSegment(e)})))}return r},t.prototype.getRegisteredSegments=function(){var e=this;return Object.keys(localStorage).reduce((function(t,n){var r=e.keys.extractSegmentName(n);return r&&t.push(r),t}),[])},t.prototype.getKeysCount=function(){return 1},t}(Bt),zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.segmentCache={},t}return U(t,e),t.prototype.clear=function(){this.segmentCache={}},t.prototype.addToSegment=function(e){return this.segmentCache[e]=!0,!0},t.prototype.removeFromSegment=function(e){return delete this.segmentCache[e],!0},t.prototype.isInSegment=function(e){return!0===this.segmentCache[e]},t.prototype.resetSegments=function(e){var t,n=this,r=!1,i=Object.keys(this.segmentCache);if(0===e.length&&i.length===e.length)return r;if(i.length!==e.length)r=!0,this.segmentCache={},e.forEach((function(e){n.addToSegment(e)}));else{for(t=0;t<e.length&&this.isInSegment(e[t]);t++);t<e.length&&(r=!0,this.segmentCache={},e.forEach((function(e){n.addToSegment(e)})))}return r},t.prototype.getRegisteredSegments=function(){return Object.keys(this.segmentCache)},t.prototype.getKeysCount=function(){return 1},t}(Bt),qt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.splitsCache={},t.ttCache={},t.changeNumber=-1,t.splitsWithSegmentsCount=0,t}return U(t,e),t.prototype.clear=function(){this.splitsCache={},this.ttCache={},this.changeNumber=-1,this.splitsWithSegmentsCount=0},t.prototype.addSplit=function(e,t){var n=this.getSplit(e);if(n){var r=JSON.parse(n);if(r.trafficTypeName){var i=r.trafficTypeName;this.ttCache[i]--,this.ttCache[i]||delete this.ttCache[i]}Pt(r)&&this.splitsWithSegmentsCount--}var s=JSON.parse(t);if(s){this.splitsCache[e]=t;var o=s.trafficTypeName;return o&&(this.ttCache[o]||(this.ttCache[o]=0),this.ttCache[o]++),Pt(s)&&this.splitsWithSegmentsCount++,!0}return!1},t.prototype.removeSplit=function(e){var t=this.getSplit(e);if(t){delete this.splitsCache[e];var n=JSON.parse(t),r=n.trafficTypeName;return r&&(this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r]),Pt(n)&&this.splitsWithSegmentsCount--,!0}return!1},t.prototype.getSplit=function(e){return this.splitsCache[e]||null},t.prototype.setChangeNumber=function(e){return this.changeNumber=e,!0},t.prototype.getChangeNumber=function(){return this.changeNumber},t.prototype.getSplitNames=function(){return Object.keys(this.splitsCache)},t.prototype.trafficTypeExists=function(e){return W(this.ttCache[e])&&this.ttCache[e]>0},t.prototype.usesSegments=function(){return-1===this.getChangeNumber()||this.splitsWithSegmentsCount>0},t}(Kt),Ht="GOOGLE_ANALYTICS_TO_SPLIT",Wt="SPLIT_TO_GOOGLE_ANALYTICS";function Qt(e){var t=Math.min(22,Math.max(0,Math.ceil(Math.log(e)/Math.log(1.5))));return Q(t)?0:t}function Vt(){return Math.random()<=.001}var Yt=function(){function e(){this.notReadyUsage=0,this.impressionStats=[0,0,0],this.eventStats=[0,0],this.lastSync={},this.httpErrors={},this.httpLatencies={},this.authRejections=0,this.tokenRefreshes=0,this.streamingEvents=[],this.tags=[],this.exceptions={},this.latencies={}}return e.prototype.getTimeUntilReady=function(){return this.timeUntilReady},e.prototype.recordTimeUntilReady=function(e){this.timeUntilReady=e},e.prototype.getTimeUntilReadyFromCache=function(){return this.timeUntilReadyFromCache},e.prototype.recordTimeUntilReadyFromCache=function(e){this.timeUntilReadyFromCache=e},e.prototype.getNonReadyUsage=function(){return this.notReadyUsage},e.prototype.recordNonReadyUsage=function(){this.notReadyUsage++},e.prototype.getImpressionStats=function(e){return this.impressionStats[e]},e.prototype.recordImpressionStats=function(e,t){this.impressionStats[e]+=t},e.prototype.getEventStats=function(e){return this.eventStats[e]},e.prototype.recordEventStats=function(e,t){this.eventStats[e]+=t},e.prototype.getLastSynchronization=function(){return this.lastSync},e.prototype.recordSuccessfulSync=function(e,t){this.lastSync[e]=t},e.prototype.popHttpErrors=function(){var e=this.httpErrors;return this.httpErrors={},e},e.prototype.recordHttpError=function(e,t){this.httpErrors[e]||(this.httpErrors[e]={}),this.httpErrors[e][t]?this.httpErrors[e][t]++:this.httpErrors[e][t]=1},e.prototype.popHttpLatencies=function(){var e=this.httpLatencies;return this.httpLatencies={},e},e.prototype.recordHttpLatency=function(e,t){this.httpLatencies[e]||(this.httpLatencies[e]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.httpLatencies[e][Qt(t)]++},e.prototype.popAuthRejections=function(){var e=this.authRejections;return this.authRejections=0,e},e.prototype.recordAuthRejections=function(){this.authRejections++},e.prototype.popTokenRefreshes=function(){var e=this.tokenRefreshes;return this.tokenRefreshes=0,e},e.prototype.recordTokenRefreshes=function(){this.tokenRefreshes++},e.prototype.popStreamingEvents=function(){return this.streamingEvents.splice(0)},e.prototype.recordStreamingEvents=function(e){this.streamingEvents.length<20&&this.streamingEvents.push(e)},e.prototype.popTags=function(){return this.tags.splice(0)},e.prototype.addTag=function(e){this.tags.length<10&&this.tags.push(e)},e.prototype.getSessionLength=function(){return this.sessionLength},e.prototype.recordSessionLength=function(e){this.sessionLength=e},e.prototype.popExceptions=function(){var e=this.exceptions;return this.exceptions={},e},e.prototype.recordException=function(e){this.exceptions[e]?this.exceptions[e]++:this.exceptions[e]=1},e.prototype.popLatencies=function(){var e=this.latencies;return this.latencies={},e},e.prototype.recordLatency=function(e,t){this.latencies[e]||(this.latencies[e]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.latencies[e][Qt(t)]++},e}();function Jt(e){return{splits:new qt,segments:new zt,impressions:new Ot(e.impressionsQueueSize),impressionCounts:e.optimize?new Lt:void 0,events:new Dt(e.eventsQueueSize),telemetry:e.mode!==S&&Vt()?new Yt:void 0,destroy:function(){this.splits.clear(),this.segments.clear(),this.impressions.clear(),this.impressionCounts&&this.impressionCounts.clear(),this.events.clear()},shared:function(){return{splits:this.splits,segments:new zt,impressions:this.impressions,impressionCounts:this.impressionCounts,events:this.events,telemetry:this.telemetry,destroy:function(){this.splits=new qt,this.segments.clear()}}}}}function Zt(e){return null!=e&&"function"==typeof e.then}function $t(e,t,n){return!t.isDestroyed()||(e.error(314,[n]),!1)}function Xt(e,t,n){return!(!t.isReady()&&!t.isReadyFromCache()&&(e.warn(203,[n]),1))}Jt.type=k;var en="definition not found",tn="not ready",nn="exception";function rn(e,t,n,r,i){return!t.isReady()||r!==en&&null!=r||(e.warn(215,[i,n]),!1)}function sn(e){var t=e.conditions,n=B(t,(function(e){return"ROLLOUT"===e.conditionType}));return n||(n=t[0]),n?n.partitions.map((function(e){return e.treatment})):[]}function on(e){var t;try{t=JSON.parse(e)}catch(e){return null}return t?{name:t.name,trafficType:t.trafficTypeName,killed:t.killed,changeNumber:t.changeNumber||0,treatments:sn(t),configs:t.configurations||{}}:null}function an(e){var t=[];return e.forEach((function(e){var n=on(e);n&&t.push(n)})),t}function un(e,t,n){var r=n.readinessManager,i=n.sdkStatus,s="split";return o(Object.create(i),{split:function(n){var i=ge(e,n,s);if(!$t(e,r,s)||!Xt(e,r,s)||!i)return null;var o=t.getSplit(i);return Zt(o)?o.catch((function(){return null})).then((function(t){return rn(e,r,i,t,s),on(t)})):(rn(e,r,i,o,s),on(o))},splits:function(){if(!$t(e,r,"splits")||!Xt(e,r,"splits"))return[];var n=t.getAll();return Zt(n)?n.catch((function(){return[]})).then(an):an(n)},names:function(){if(!$t(e,r,"names")||!Xt(e,r,"names"))return[];var n=t.getSplitNames();return Zt(n)?n.catch((function(){return[]})):n}})}var cn=function(){function e(){this.attributesCache={}}return e.prototype.setAttribute=function(e,t){return this.attributesCache[e]=t,!0},e.prototype.getAttribute=function(e){return this.attributesCache[e]},e.prototype.setAttributes=function(e){return this.attributesCache=o(this.attributesCache,e),!0},e.prototype.getAll=function(){return this.attributesCache},e.prototype.removeAttribute=function(e){return Object.keys(this.attributesCache).indexOf(e)>=0&&(delete this.attributesCache[e],!0)},e.prototype.clear=function(){return this.attributesCache={},!0},e}();function ln(e,t,n){return null==t||V(t)?t:(e.error(311,[n,"attributes"]),!1)}function fn(e,t,n){if(!ln(e,t,n))return!1;var r=!0;return Object.keys(t).forEach((function(i){(function(e,t,n,r){if(!Y(t)||0===t.length)return e.warn(r+": you passed an invalid attribute name, attribute name must be a non-empty string."),!1;var i=Y(n),s=W(n),o=H(n),a=Array.isArray(n);return!!(i||s||o||a)||(e.warn(r+": you passed an invalid attribute value for "+t+". Acceptable types are: string, number, boolean and array of strings."),!1)})(e,i,t[i],n)||(r=!1)})),r}function hn(e,t,n,r){var i=function(e,t){var n=new cn,r=t.getTreatment,i=t.getTreatmentWithConfig,s=t.getTreatments,a=t.getTreatmentsWithConfig,u=t.track;function c(e){var t=n.getAll();return Object.keys(t).length>0?o({},t,e):e}return o(t,{getTreatment:function(e,t,n){return r(e,t,c(n))},getTreatmentWithConfig:function(e,t,n){return i(e,t,c(n))},getTreatments:function(e,t,n){return s(e,t,c(n))},getTreatmentsWithConfig:function(e,t,n){return a(e,t,c(n))},track:function(e,t,n,r,i){return u(e,t,n,r,i)},setAttribute:function(t,r){var i={};return i[t]=r,!!fn(e,i,"setAttribute")&&(e.debug("stored "+r+" for attribute "+t),n.setAttribute(t,r))},getAttribute:function(t){return e.debug("retrieved attribute "+t),n.getAttribute(t+"")},setAttributes:function(t){return!!fn(e,t,"setAttributes")&&n.setAttributes(t)},getAttributes:function(){return n.getAll()},removeAttribute:function(t){return e.debug("removed attribute "+t),n.removeAttribute(t+"")},clearAttributes:function(){return n.clear()}})}(e,t);return o(i,{getTreatment:i.getTreatment.bind(i,n),getTreatmentWithConfig:i.getTreatmentWithConfig.bind(i,n),getTreatments:i.getTreatments.bind(i,n),getTreatmentsWithConfig:i.getTreatmentsWithConfig.bind(i,n),track:r?i.track.bind(i,n,r):i.track.bind(i,n),isClientSide:!0})}var pn={UNDEFINED:0,ALL_KEYS:1,IN_SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,EQUAL_TO_SET:8,CONTAINS_ANY_OF_SET:9,CONTAINS_ALL_OF_SET:10,PART_OF_SET:11,ENDS_WITH:12,STARTS_WITH:13,CONTAINS_STRING:14,IN_SPLIT_TREATMENT:15,EQUAL_TO_BOOLEAN:16,MATCHES_STRING:17},gn="BOOLEAN",dn="STRING",mn="NUMBER",vn="DATETIME",yn="NOT_SPECIFIED";function bn(e){return e.whitelist}function Sn(e){return e.value}function Tn(e){return new Date(e).setUTCHours(0,0,0,0)}function En(e){return new Date(e).setUTCSeconds(0,0)}function wn(e){var t=e.map((function(e){var t,n=e.matcherType,r=e.negate,i=e.keySelector,s=e.userDefinedSegmentMatcherData,o=e.whitelistMatcherData,a=e.unaryNumericMatcherData,u=e.betweenMatcherData,c=e.dependencyMatcherData,l=e.booleanMatcherData,f=e.stringMatcherData,h=i&&i.attribute,p=function(e){return pn[e]||pn.UNDEFINED}(n),g=dn,d=void 0;return p===pn.IN_SEGMENT?d=(t=s)?t.segmentName:void 0:p===pn.WHITELIST?d=function(e){return new yt(e.whitelist)}(o):p===pn.EQUAL_TO?(d=Sn(a),g=mn,"DATETIME"===a.dataType&&(d=Tn(d),g=vn)):p===pn.GREATER_THAN_OR_EQUAL_TO||p===pn.LESS_THAN_OR_EQUAL_TO?(d=Sn(a),g=mn,"DATETIME"===a.dataType&&(d=En(d),g=vn)):p===pn.BETWEEN?(g=mn,"DATETIME"===(d=u).dataType&&(d.start=En(d.start),d.end=En(d.end),g=vn)):p===pn.EQUAL_TO_SET||p===pn.CONTAINS_ANY_OF_SET||p===pn.CONTAINS_ALL_OF_SET||p===pn.PART_OF_SET?(d=bn(o),g="SET"):p===pn.STARTS_WITH||p===pn.ENDS_WITH||p===pn.CONTAINS_STRING?d=bn(o):p===pn.IN_SPLIT_TREATMENT?(d=c,g=yn):p===pn.EQUAL_TO_BOOLEAN?(g=gn,d=l):p===pn.MATCHES_STRING&&(d=f),{attribute:h,negate:r,type:p,value:d,dataType:g}}));return-1===G(t,(function(e){return e.type===pn.UNDEFINED}))?t:[]}var _n=function(){function e(e,t){if(100!==e[e.length-1])throw new RangeError("Provided invalid dataset as input");this._ranges=e,this._treatments=t}return e.parse=function(t){var n=t.reduce((function(e,t){var n=t.size,r=t.treatment;return e.ranges.push(e.inc+=n),e.treatments.push(r),e}),{inc:0,ranges:[],treatments:[]});return new e(n.ranges,n.treatments)},e.prototype.getTreatmentFor=function(e){if(e<0||e>100)throw new RangeError("Please provide a value between 0 and 100");var t=G(this._ranges,(function(t){return e<=t}));return this._treatments[t]},e}(),kn=[void 0,function(e){return function(t){return e.debug(4),null!=t}},function(e,t,n){return function(r){var i=n.segments.isInSegment(t,r);return Zt(i)?i.then((function(n){return e.debug(18,[t,r,i]),n})):e.debug(18,[t,r,i]),i}},function(e,t){return function(n){var r=t.has(n);return e.debug(22,[n,vt(t).join(","),r]),r}},function(e,t){return function(n){var r=n===t;return e.debug(12,[n,t,r]),r}},function(e,t){return function(n){var r=n>=t;return e.debug(15,[n,t,r]),r}},function(e,t){return function(n){var r=n<=t;return e.debug(16,[n,t,r]),r}},function(e,t){return function(n){var r=n>=t.start&&n<=t.end;return e.debug(5,[n,t.start,t.end,r]),r}},function(e,t){return function(n){for(var r=n.length===t.length,i=function(e){G(t,(function(t){return t===n[e]}))<0&&(r=!1)},s=0;s<n.length&&r;s++)i(s);return e.debug(13,[n,t,r]),r}},function(e,t){return function(n){for(var r=!1,i=function(e){G(n,(function(n){return n===t[e]}))>=0&&(r=!0)},s=0;s<t.length&&!r;s++)i(s);return e.debug(8,[n,t,r]),r}},function(e,t){return function(n){var r=!0;if(n.length<t.length)r=!1;else for(var i=function(e){G(n,(function(n){return n===t[e]}))<0&&(r=!1)},s=0;s<t.length&&r;s++)i(s);return e.debug(7,[n,t,r]),r}},function(e,t){return function(n){for(var r=n.length<=t.length,i=function(e){G(t,(function(t){return t===n[e]}))<0&&(r=!1)},s=0;s<n.length&&r;s++)i(s);return e.debug(17,[n,t,r]),r}},function(e,t){return function(n){var r=t.some((function(e){return r=e,void 0===i&&(i=!1),!(!Y(t=n)||!Y(r))&&(i&&(t=t.toLowerCase(),r=r.toLowerCase()),t.slice(t.length-r.length)===r);var t,r,i}));return e.debug(14,[n,t,r]),r}},function(e,t){return function(n){var r=t.some((function(e){return $(n,e)}));return e.debug(21,[n,t,r]),r}},function(e,t){return function(n){var r=t.some((function(e){return Y(n)&&n.indexOf(e)>-1}));return e.debug(9,[n,t,r]),r}},function(e,t,n){var r=t.split,i=t.treatments;function s(t,n,r){var i=!1;return Array.isArray(n)&&(i=-1!==n.indexOf(t.treatment)),e.debug(10,[r,t.treatment,t.label,r,n,i]),i}return function(t,o){var a=t.key,u=t.attributes;e.debug(11,[r,JSON.stringify(a),u?"\n attributes: "+JSON.stringify(u):""]);var c=o(e,a,r,u,n);return Zt(c)?c.then((function(e){return s(e,i,r)})):s(c,i,r)}},function(e,t){return function(n){var r=t===n;return e.debug(6,[t,n]),r}},function(e,t){return function(n){var r;try{r=new RegExp(t)}catch(n){return e.debug(20,[t]),!1}var i=r.test(n);return e.debug(19,[n,t,i?"yes":"no"]),i}}];function Rn(e,t,n){var r,i=t.type,s=t.value;return kn[i]&&(r=kn[i](e,s,n)),r}function Cn(e,t){return{key:e,attributes:t}}function An(e,t,n,r){var i=n.attribute,s=function(e,t,n,r){var i=void 0;return n?r?(i=r[n],e.debug(23,[n,i])):e.warn(201,[n]):i=t,i}(e,t,i,r),o=function(e,t,n,r,i){var s,o,a,u,c=function(e,t){switch(e){case pn.EQUAL_TO:return"DATETIME"===t?Tn:void 0;case pn.GREATER_THAN_OR_EQUAL_TO:case pn.LESS_THAN_OR_EQUAL_TO:case pn.BETWEEN:return"DATETIME"===t?En:void 0;case pn.IN_SPLIT_TREATMENT:return Cn;default:return}}(t,r);switch(r){case mn:case vn:o=X(n),s=isNaN(o)?void 0:o;break;case dn:u=a=n,V(a)&&(u=a.matchingKey?a.matchingKey:void 0),s=ee(u)||void 0;break;case"SET":s=function(e){var t=Array.isArray(e)?te(e.map((function(e){return e+""}))):[];return t.length?t:void 0}(n);break;case gn:s=function(e){if(!0===e||!1===e)return e;if("string"==typeof e){var t=e.toLocaleLowerCase();if("true"===t)return!0;if("false"===t)return!1}}(n);break;case yn:s=n;break;default:s=void 0}return c&&(s=c(s,i)),e.debug(24,[n,r,s instanceof Object?JSON.stringify(s):s]),s}(e,n.type,s,n.dataType,r);return void 0!==o?o:void e.warn(200,[s+(i?" for attribute "+i:"")])}function Nn(e,t,n,r,i,s){if(t){var o=function(e,t,n,r){var i=ot(t,n),s=r.getTreatmentFor(i);return e.debug(3,[i,t,n,s]),s}(e,n,r,i);return{treatment:o,label:s}}}function On(e,t,n,r,i){return function(s,o,a,u,c,l){if("ROLLOUT"===i&&!function(e,t,n){return!(e<100&&ot(t,n)>e)}(a,s.bucketingKey,u))return{treatment:void 0,label:"not in split"};var f=t(s,c,l);return Zt(f)?f.then((function(t){return Nn(e,t,s.bucketingKey,o,n,r)})):Nn(e,f,s.bucketingKey,o,n,r)}}function In(e,t){function n(t){var n=t.every((function(e){return e}));return e.debug(0,[n]),n}return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=t.map((function(t){return t.apply(void 0,e)}));return-1!==G(i,Zt)?Promise.all(i).then(n):n(i)}}function Ln(e,t){return{treatment:q(e,"treatment",t),label:q(e,"label","default rule")}}var Dn=function(){function e(e,t){this.baseInfo=e,this.evaluator=t,"string"!=typeof this.baseInfo.defaultTreatment&&(this.baseInfo.defaultTreatment=p)}return e.parse=function(t,n,r){return new e(n,function(e,t,n){for(var r=[],i=0;i<t.length;i++){var s=t[i],o=s.matcherGroup,a=s.partitions,u=s.label,c=s.conditionType,l=wn(o.matchers).map((function(t){var r=Rn(e,t,n);return function(n,i,s){var o=An(e,n,t,i),a=!(void 0===o||!r)&&r(o,s);return Zt(a)?a.then((function(e){return Boolean(e^t.negate)})):Boolean(a^t.negate)}}));if(0===l.length){r=[];break}r.push(On(e,In(e,l),_n.parse(a),u,c))}return function(e,t){function n(t){for(var n=t.length,r=0;r<n;r++){var i=t[r];if(void 0!==i)return e.debug(1,[i.treatment]),i}e.debug(2)}return!Array.isArray(t)||Array.isArray(t)&&0===t.length?function(){return e.error(300),{treatment:p,label:nn}}:function(e,r,i,s,o,a){var u=t.map((function(t){return t(e,r,i,s,o,a)}));return-1!==G(u,Zt)?Promise.all(u).then((function(e){return n(e)})):n(u)}}(e,r)}(t,n.conditions,r))},e.prototype.getKey=function(){return this.baseInfo.name},e.prototype.getTreatment=function(e,t,n){var r,i,s,o=this.baseInfo,a=o.killed,u=o.seed,c=o.defaultTreatment,l=o.trafficAllocation,f=o.trafficAllocationSeed;try{r=pt(e)}catch(e){return{treatment:p,label:nn}}if(this.isGarbage())i=p,s="archived";else{if(!a){var h=this.evaluator(r,u,l,f,t,n);return Zt(h)?h.then((function(e){return Ln(e,c)})):Ln(h,c)}i=c,s="killed"}return{treatment:i,label:s}},e.prototype.isGarbage=function(){return"ARCHIVED"===this.baseInfo.status},e.prototype.getChangeNumber=function(){return this.baseInfo.changeNumber},e}(),Mn={treatment:p,label:nn,config:null};function xn(e){var t={};return e.forEach((function(e){t[e]=Mn})),t}function Fn(e,t,n,r,i){var s;try{s=i.splits.getSplit(n)}catch(e){return Mn}return Zt(s)?s.then((function(n){return Kn(e,n,t,r,i)})).catch((function(){return Mn})):Kn(e,s,t,r,i)}function Kn(e,t,n,r,i){var s={treatment:p,label:en,config:null};if(t){var o=JSON.parse(t),a=Dn.parse(e,o,i);if(Zt(s=a.getTreatment(n,r,Fn)))return s.then((function(e){return e.changeNumber=a.getChangeNumber(),e.config=o.configurations&&o.configurations[e.treatment]||null,e}));s.changeNumber=a.getChangeNumber(),s.config=o.configurations&&o.configurations[s.treatment]||null}return s}function Pn(e,t,n,r,i,s){var o={},a=[];return t.forEach((function(t){var u=Kn(e,n[t],r,i,s);Zt(u)?a.push(u.then((function(e){o[t]=e}))):o[t]=u})),a.length>0?Promise.all(a).then((function(){return o})):o}function Un(e,t,n){e.warn(217,[n,t])}var jn=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/,Bn="event_type";function Gn(e,t,n){if(null==t)e.error(u,[n,Bn]);else if(Y(t))if(0===t.length)e.error(l,[n,Bn]);else{if(jn.test(t))return t;e.error(310,[n,t])}else e.error(c,[n,Bn]);return!1}function zn(e,t,n){return W(t)||null==t?t:(e.error(313,[n]),!1)}var qn=1024;function Hn(e,t,n){if(null==t)return{properties:null,size:qn};if(!V(t))return e.error(311,[n,"properties"]),{properties:!1,size:qn};var r=Object.keys(t),i=o({},t),s={properties:i,size:qn};r.length>300&&e.warn(212,[n]);for(var a=0;a<r.length;a++){s.size+=2*r[a].length;var u=i[r[a]],c=Y(u),l=W(u),f=H(u),h=null===u;if(c||l||f||h||(i[r[a]]=null,u=null,h=!0,e.warn(211,[n,r[a]])),h?s.size+=0:l?s.size+=8:f?s.size+=4:c&&(s.size+=2*u.length),s.size>32768){e.error(312,[n]),s.properties=!1;break}}return s}function Wn(e){return[E,T,_].indexOf(e.mode)>-1}function Qn(e){return!!Wn(e)&&e.sync.impressionsMode===b}function Vn(e){return-1===[w,_].indexOf(e.mode)}function Yn(e,t){var n=e.sdkReadinessManager,r=e.syncManager,i=e.storage,s=e.signalListener,a=e.settings,u=e.telemetryTracker;return o(Object.create(n.sdkStatus),function(e,t,n){var r=e.log,i=Vn(e);function s(e,t,i,s){var o=$(s,"getTreatments"),a=ye(r,e,s),u=o?de(r,t,s):ge(r,t,s),c=ln(r,i,s),l=$t(r,n,s);return Xt(r,n,s),{valid:l&&a&&u&&!1!==c,key:a,splitOrSplits:u,attributes:c}}function a(e){return i?e:Promise.resolve(e)}return{getTreatment:function(e,n,r){var i=s(e,n,r,"getTreatment");return i.valid?t.getTreatment(i.key,i.splitOrSplits,i.attributes):a(p)},getTreatmentWithConfig:function(e,n,r){var i=s(e,n,r,"getTreatmentWithConfig");return i.valid?t.getTreatmentWithConfig(i.key,i.splitOrSplits,i.attributes):a(o({},g))},getTreatments:function(e,n,r){var i=s(e,n,r,"getTreatments");if(i.valid)return t.getTreatments(i.key,i.splitOrSplits,i.attributes);var o={};return i.splitOrSplits&&i.splitOrSplits.forEach((function(e){return o[e]=p})),a(o)},getTreatmentsWithConfig:function(e,n,r){var i=s(e,n,r,"getTreatmentsWithConfig");if(i.valid)return t.getTreatmentsWithConfig(i.key,i.splitOrSplits,i.attributes);var u={};return i.splitOrSplits&&i.splitOrSplits.forEach((function(e){return u[e]=o({},g)})),a(u)},track:function(e,s,o,a,u){var c=ye(r,e,"track"),l=Te(r,s,"track"),f=Gn(r,o,"track"),h=zn(r,a,"track"),p=Hn(r,u,"track"),g=p.properties,d=p.size;return $t(r,n,"track")&&c&&l&&f&&!1!==h&&!1!==g?t.track(c,l,f,h,g,d):!i&&Promise.resolve(!1)}}}(a,function(e){var t=e.sdkReadinessManager.readinessManager,n=e.storage,r=e.settings,i=e.impressionsTracker,s=e.eventTracker,o=e.telemetryTracker,a=r.log,u=r.mode;function c(e,t,r,s){void 0===s&&(s=!1);var u=o.trackEval(s?"tc":"t"),c=function(n){var o=[],a=f(n,t,e,0,s,"getTreatment"+(s?"withConfig":""),o);return i.track(o,r),u(o[0]&&o[0].label),a},l=Fn(a,e,t,r,n);return Zt(l)?l.then((function(e){return c(e)})):c(l)}function l(e,t,r,s){void 0===s&&(s=!1);var u=o.trackEval(s?"tcs":"ts"),c=function(t){var n=[],o={};return Object.keys(t).forEach((function(r){o[r]=f(t[r],r,e,0,s,"getTreatments"+(s?"withConfig":""),n)})),i.track(n,r),u(n[0]&&n[0].label),o},l=function(e,t,n,r,i){var s;try{s=i.splits.getSplits(n)}catch(e){return xn(n)}return Zt(s)?s.then((function(s){return Pn(e,n,s,t,r,i)})).catch((function(){return xn(n)})):Pn(e,n,s,t,r,i)}(a,e,t,r,n);return Zt(l)?l.then((function(e){return c(e)})):c(l)}function f(e,n,r,i,s,o,u){var c=t.isReady()||t.isReadyFromCache(),l=ht(r),f=function(e){return V(e)?e.bucketingKey:void 0}(r);c||(e={treatment:p,label:tn});var h=e.treatment,g=e.label,d=e.changeNumber,m=e.config,v=void 0===m?null:m;return a.info(102,[n,l,h,g]),rn(a,t,n,g,o)&&(a.info(103),u.push({feature:n,keyName:l,treatment:h,time:Date.now(),bucketingKey:f,label:g,changeNumber:d})),s?{treatment:h,config:v}:h}return{getTreatment:c,getTreatmentWithConfig:function(e,t,n){return c(e,t,n,!0)},getTreatments:l,getTreatmentsWithConfig:function(e,t,n){return l(e,t,n,!0)},track:function(e,r,i,c,l,f){void 0===f&&(f=1024);var h=o.trackEval("tr"),p=ht(e),g={eventTypeId:i,trafficTypeName:r,value:c,timestamp:Date.now(),key:p,properties:l};!function(e,t,n,r,i,s){if(!t.isReady()||r===S)return!0;var o=n.trafficTypeExists(i);Zt(o)?o.then((function(t){return t||Un(e,i,s),t})):o||Un(e,i,s)}(a,t,n.splits,u,r,"track");var d=s.track(g,f);return Zt(d)?d.then((function(e){return h(),e})):(h(),d)},isClientSide:!1}}(e),n.readinessManager),{destroy:function(){return t||u.sessionLength(),r&&r.stop(),(r?r.flush():Promise.resolve()).then((function(){var e;return n.readinessManager.destroy(),s&&s.stop(),t||(e=a.core.authorizationKey,Ne[e]&&Ne[e]--,0===Ne[e]&&delete Ne[e]),i.destroy()}))}})}function Jn(e,t){return(e.matchingKey?e.matchingKey:e)+"-"+(e.bucketingKey?e.bucketingKey:e)+"-"+(void 0!==t?t:"")}var Zn="Client instantiation";function $n(e){var t=e.storage,n=e.syncManager,r=e.sdkReadinessManager,i=e.settings,s=i.core,a=s.key,u=s.trafficType,c=i.startup.readyTimeout,l=i.log,f=hn(l,Yn(e),a,u),h=Jn(pt(a),u),p={};return p[h]=f,function(i,s){if(void 0===i)return l.debug(27),f;var a,u=ye(l,i,"Shared "+Zn);if(!1===u)throw new Error("Shared Client needs a valid key.");if(void 0!==s&&!1===(a=Te(l,s,"Shared "+Zn)))throw new Error("Shared Client needs a valid traffic type or no traffic type at all.");var h=Jn(u,a);if(p[h])l.debug(28);else{var g=ht(u),d=r.shared(c),m=t.shared&&t.shared(g,(function(e){e||d.readinessManager.segments.emit(ue)})),v=n&&m&&n.shared(g,d.readinessManager,m);p[h]=hn(l,Yn(o({},e,{sdkReadinessManager:d,storage:m||t,syncManager:v,signalListener:void 0}),!0),u,a),v&&v.start(),l.info(104)}return p[h]}}var Xn=function(){function e(e){var t=this;this.__mapKeysData__=[],this.__mapValuesData__=[],Array.isArray(e)&&e.forEach((function(e){t.set(e[0],e[1])}))}return e.prototype.clear=function(){this.__mapKeysData__.length&&(this.__mapKeysData__.length=0,this.__mapValuesData__.length=0)},e.prototype.set=function(e,t){var n=this.__mapKeysData__.indexOf(e);return-1===n&&(n=this.__mapKeysData__.push(e)-1),this.__mapValuesData__[n]=t,this},e.prototype.delete=function(e){var t=this.__mapKeysData__.indexOf(e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),!0)},e.prototype.get=function(e){var t=this.__mapKeysData__.indexOf(e);if(-1!==t)return this.__mapValuesData__[t]},Object.defineProperty(e.prototype,"size",{get:function(){return this.__mapKeysData__.length},enumerable:!1,configurable:!0}),e}(),er="function"==typeof Array.from&&"function"==typeof Map&&Map.prototype&&Map.prototype.values?Map:Xn,tr=function(e,t,n,r){this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null},nr=function(){function e(){this.tail=null,this.head=null,this.length=0}return e.prototype.removeNode=function(e){if(e&&e instanceof tr){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t}},e.prototype.unshiftNode=function(e){if(e&&e instanceof tr&&e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},e.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)this.head=new tr(arguments[e],null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},e}(),rr=function(){function e(e){this.maxLen=e||1,this.items=new er,this.lru=new nr}return e.prototype.get=function(e){var t=this.items.get(e);if(t&&t instanceof tr)return this.lru.unshiftNode(t),t.value.value},e.prototype.set=function(e,t){var n=this.items.get(e);if(n){if(!(n instanceof tr))return!1;this.lru.unshiftNode(n),this.lru.head.value.value=t}else{if(this.lru.length===this.maxLen){var r=this.lru.tail;if(!r)return!1;this.items.delete(r.value.key),this.lru.removeNode(this.lru.tail)}this.lru.unshift({key:e,value:t}),this.items.set(e,this.lru.head)}return!0},e}(),ir=function(){function e(e,t){this.cache=new rr(e),this.hasher=t}return e.prototype.testAndSet=function(e){var t=this.hasher(e),n=this.cache.get(t);return this.cache.set(t,e.time),n},e}();function sr(e){return st(function(e){return e.keyName+":"+e.feature+":"+e.treatment+":"+e.label+":"+e.changeNumber}(e))}function or(){return new ir(500,sr)}var ar,ur="ga-to-split: ",cr="ga-to-split:mapper",lr=(ar={eventTypeId:{event:"eventAction",social:"socialAction"},eventValue:{event:"eventValue",timing:"timingValue"},eventProperties:{pageview:["page"],screenview:["screenName"],event:["eventCategory","eventLabel"],social:["socialNetwork","socialTarget"],timing:["timingCategory","timingVar","timingLabel"],exception:["exDescription","exFatal"]}},function(e){var t=e.get("hitType"),n=e.get(ar.eventTypeId[t]||"hitType"),r=e.get(ar.eventValue[t]),i={},s=ar.eventProperties[t];if(s)for(var o=0;o<s.length;o++){var a=e.get(s[o]);void 0!==a&&(i[s[o]]=a)}return{eventTypeId:n,value:r,properties:i,timestamp:Date.now()}});var fr=/^[^a-zA-Z0-9]+/,hr=/[^-_.:a-zA-Z0-9]+/g;function pr(e,t){var n=t.storage,r=t.settings,i=r.core,s=r.log,a={prefix:"ga",identities:i.key&&i.trafficType?[{key:i.key,trafficType:i.trafficType}]:void 0};!function(e,t,n,r,i){var s=e.GoogleAnalyticsObject||"ga";e[s]=e[s]||function(){(e[s].q=e[s].q||[]).push(arguments)},e[s]("provide","splitTracker",n),!i||e[s].q&&e[s].q.push!==[].push||r.error(ur+"integration is configured to autorequire the splitTracker plugin, but the necessary script does not seem to have run. Please check the docs.")}(window,0,(function(t,r){var i=o({},a,e,r);this.tracker=t;var u=function(e){if(!Array.isArray(e))return[];var t=function(e,t){void 0===t&&(t=JSON.stringify);var n={};return e.filter((function(e){var r=t(e);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)}))}(e);return t.filter((function(e){if(!e)return!1;var t=e.key,n=e.trafficType;return!(!Y(t)&&!W(t)||!Y(n))}))}(i.identities);if(0!==u.length){var c=u.length-i.identities.length;c&&s.warn(ur+(c+" identities were discarded because they are invalid or duplicated. Identities must be an array of objects with key and trafficType.")),i.identities=u,Y(i.prefix)||(s.warn(ur+"The provided `prefix` was ignored since it is invalid. Please check that you are passing a string object as `prefix`."),i.prefix=void 0);var l=t.get("sendHitTask");t.set("sendHitTask",(function(e){if(l(e),!1!==i.hits&&!e.get("splitHit")){try{if(i.filter&&!i.filter(e))return}catch(e){return void s.warn(ur+"custom filter threw: "+e)}var t=lr(e);if(i.mapper){try{t=i.mapper(e,t)}catch(e){return void s.warn(ur+"custom mapper threw: "+e)}if(!t)return}i.prefix&&(t.eventTypeId=i.prefix+"."+t.eventTypeId),t.eventTypeId=function(e,t){if(!Y(t)||0===t.length)return t;var n=t.replace(fr,"").replace(hr,"_"),r=n.slice(0,80);return r.length<n.length&&e.warn(ur+"EventTypeId was truncated because it cannot be more than 80 characters long."),r}(s,t.eventTypeId),function(e,t){return!(!Gn(e,t.eventTypeId,cr)||!1===zn(e,t.value,cr)||!1===Hn(e,t.properties,cr).properties||t.timestamp&&!W(t.timestamp)||t.key&&!1===ye(e,t.key,cr)||t.trafficTypeName&&!1===Te(e,t.trafficTypeName,cr))}(s,t)&&(t.key&&t.trafficTypeName?n.events.track(t):i.identities.forEach((function(e){var r=o({key:e.key,trafficTypeName:e.trafficType},t);n.events.track(r)})))}})),s.info(ur+"integration started")}else s.warn(ur+"No valid identities were provided. Please check that you are passing a valid list of identities or providing a traffic type at the SDK configuration.")}),s,!0===e.autoRequire)}var gr="split-to-ga: ",dr="`ga` command queue not found.",mr="No hit was sent.",vr=function(){function e(t,n){this.trackerNames=e.defaultTrackerNames,this.log=t,n&&("function"==typeof n.filter&&(this.filter=n.filter),"function"==typeof n.mapper&&(this.mapper=n.mapper),Array.isArray(n.trackerNames)&&(this.trackerNames=te(n.trackerNames)),this.impressions=n.impressions,this.events=n.events),t.info("split-to-ga: integration started"),"function"!=typeof e.getGa()&&t.warn(gr+(dr+" No hits will be sent until it is available."))}return e.defaultMapper=function(e){var t=e.type,n=e.payload;switch(t){case m:return{hitType:"event",eventCategory:"split-impression",eventAction:"Evaluate "+n.impression.feature,eventLabel:"Treatment: "+n.impression.treatment+". Targeting rule: "+n.impression.label+".",nonInteraction:!0};case v:return{hitType:"event",eventCategory:"split-event",eventAction:n.eventTypeId,eventValue:n.value,nonInteraction:!0}}},e.getGa=function(){return"undefined"!=typeof window?window[window.GoogleAnalyticsObject||"ga"]:void 0},e.validateFieldsObject=function(e,t){return!(!t||!t.hitType)||(e.warn("split-to-ga: your custom mapper returned an invalid FieldsObject instance. It must be an object with at least a `hitType` field."),!1)},e.prototype.queue=function(t){var n=e.getGa();if(n){if(!1===this.impressions&&t.type===m)return;if(!1===this.events&&t.type===v)return;var r;try{if(this.filter&&!this.filter(t))return;if(r=e.defaultMapper(t),this.mapper&&(!(r=this.mapper(t,r))||!e.validateFieldsObject(this.log,r)))return}catch(e){return void this.log.warn("split-to-ga: queue method threw: "+e+". "+mr)}this.trackerNames.forEach((function(e){var t=e?e+".send":"send";r.splitHit=!0,n(t,r)}))}else this.log.warn(gr+(dr+" ")+mr)},e.defaultTrackerNames=[""],e}();function yr(e,t){var n=e.map((function(e){switch(e.type){case Ht:return function(e){function t(t){return pr(e,t)}return void 0===e&&(e={}),t.type="GOOGLE_ANALYTICS_TO_SPLIT",t}(e);case Wt:return function(e){function t(t){return new vr(t.settings.log,e)}return void 0===e&&(e={}),t.type="SPLIT_TO_GOOGLE_ANALYTICS",t}(e)}})).filter((function(e){return e&&"function"==typeof e}));return function(e,t){var n=[];if(e.forEach((function(e){var r=e(t);r&&r.queue&&n.push(r)})),0!==n.length)return{handleImpression:function(e){n.forEach((function(t){return t.queue({type:m,payload:e})}))},handleEvent:function(e){n.forEach((function(t){return t.queue({type:v,payload:e})}))}}}(n,t)}function br(e){var t=Jt(e);return t.splits.checkCache=function(){return!0},t}function Sr(e,t){var n=!1,r=!1,i=function e(i){var s=new Promise((function(e,n){return i.then(e,(function(e){r?n(e):t(e)}))})),o=s.then;return Object.defineProperty(s,"then",{value:function(t,i){var a=o.call(s,t,i);return"function"==typeof t&&(n=!0),"function"==typeof i?(r=!0,a):e(a)}}),s}(e);return i.hasOnFulfilled=function(){return n},i}function Tr(e,t,n){void 0===t&&(t=0),void 0===n&&(n=function(e){var t=o(new e,{splitsArrived:!1,splitsCacheLoaded:!1});return t.on(oe,(function(e){e||(t.splitsArrived=!0)})),t.once(ae,(function(){t.splitsCacheLoaded=!0})),t}(e));var r=function(e){var t=o(new e,{segmentsArrived:!1});return t.once(ue,(function(){t.segmentsArrived=!0})),t}(e),i=new e,s=!1;n.splitsCacheLoaded?s=!0:n.once(ae,(function(){if(s=!0,!c)try{i.emit(fe)}catch(e){setTimeout((function(){throw e}),0)}}));var a,u=!1;t>0&&(a=setTimeout((function(){u=!0,i.emit(ce,"Split SDK emitted SDK_READY_TIMED_OUT event.")}),t));var c=!1;n.on(oe,f),r.on(ue,f);var l=!1;function f(e){if(c)try{i.emit(he,e)}catch(e){setTimeout((function(){throw e}),0)}else if(n.splitsArrived&&r.segmentsArrived){clearTimeout(a),c=!0;try{i.emit(le)}catch(e){setTimeout((function(){throw e}),0)}}}var h=1;return{splits:n,segments:r,gate:i,shared:function(t){return void 0===t&&(t=0),h++,Tr(e,t,n)},destroy:function(){l=!0,r.removeAllListeners(),i.removeAllListeners(),clearTimeout(a),h>0&&h--,0===h&&n.removeAllListeners()},isReady:function(){return c},hasTimedout:function(){return u},isReadyFromCache:function(){return s},isDestroyed:function(){return l},isOperational:function(){return(c||s)&&!l}}}function Er(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=Tr(t,n));var i=0,s=0;r.gate.on("removeListener",(function(e){e===le&&s--})),r.gate.on("newListener",(function(t){t!==le&&t!==ce||(r.isReady()?e.error(302,[t===le?"SDK_READY":"SDK_READY_TIMED_OUT"]):t===le&&s++)}));var a,u=a=Sr(new Promise((function(t,n){r.gate.once(le,(function(){e.info(101),s!==i||a.hasOnFulfilled()||e.warn(202),t()})),r.gate.once(ce,(function(e){n(new Error(e))}))})),c);function c(t){e.error(t&&t.message)}return r.gate.once(fe,(function(){e.info(100)})),{readinessManager:r,shared:function(n){return void 0===n&&(n=0),Er(e,t,n,r.shared(n))},incInternalReadyCbCount:function(){i++},sdkStatus:o(Object.create(r.gate),{Event:{SDK_READY:le,SDK_READY_FROM_CACHE:fe,SDK_UPDATE:he,SDK_READY_TIMED_OUT:ce},ready:function(){return r.hasTimedout()?r.isReady()?Promise.resolve():Sr(Promise.reject(new Error("Split SDK has emitted SDK_READY_TIMED_OUT event.")),c):u},__getStatus:function(){return{isReady:r.isReady(),isReadyFromCache:r.isReadyFromCache(),isOperational:r.isOperational(),hasTimedout:r.hasTimedout(),isDestroyed:r.isDestroyed()}}})}}br.type=k;var wr={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},_r={DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5};function kr(e){return!!B(wr,(function(t){return e===t}))}function Rr(e,t){void 0===e&&(e=""),void 0===t&&(t=[]);var n=0;return e.replace(/%s/g,(function(){return t[n++]}))}var Cr={prefix:"splitio",logLevel:wr.NONE,showLevel:!0},Ar=function(){function e(e,t){this.options=o({},Cr,e),this.codes=t||new er,this.logLevel=_r[this.options.logLevel]}return e.prototype.setLogLevel=function(e){this.options.logLevel=e,this.logLevel=_r[e]},e.prototype.debug=function(e,t){this._shouldLog(_r.DEBUG)&&this._log(wr.DEBUG,e,t)},e.prototype.info=function(e,t){this._shouldLog(_r.INFO)&&this._log(wr.INFO,e,t)},e.prototype.warn=function(e,t){this._shouldLog(_r.WARN)&&this._log(wr.WARN,e,t)},e.prototype.error=function(e,t){this._shouldLog(_r.ERROR)&&this._log(wr.ERROR,e,t)},e.prototype._log=function(e,t,n){if("number"==typeof t){var r=this.codes.get(t);t=r?Rr(r,n):"Message code "+t+(n?", with args: "+n.toString():"")}else n&&(t=Rr(t,n));var i=this._generateLogMessage(e,t);console.log(i)},e.prototype._generateLogMessage=function(e,t){var n="";return this.options.showLevel&&(n+="["+e+"]"+(e===wr.INFO||e===wr.WARN?" ":"")+" "),this.options.prefix&&(n+=this.options.prefix+" => "),n+t},e.prototype._shouldLog=function(e){return e>=this.logLevel},e}();function Nr(e){function t(t){kr(t)?e.setLogLevel(t):e.error(301)}return{enable:function(){t(wr.DEBUG)},setLogLevel:t,disable:function(){t(wr.NONE)},LogLevel:wr}}function Or(e){return{s:e.version,i:e.runtime.ip||d,n:e.runtime.hostname||d}}function Ir(e){var t=e.settings,n=e.platform,r=e.storageFactory,i=e.splitApiFactory,s=e.extraProps,a=e.syncManagerFactory,h=e.SignalListener,p=e.impressionsObserverFactory,g=e.integrationsManagerFactory,d=e.sdkManagerFactory,m=e.sdkClientMethodFactory,v=t.log;!function(e,t){var n=function(e,t){var n=!1;return null==t?e.error(u,[f,Ae]):Y(t)?t.length>0?n=t:e.error(l,[f,Ae]):e.error(c,[f,Ae]),n}(e,t);n&&(Ne[n]?(e.warn(222,[Ne[n]+" factory/ies with this API Key"]),Ne[n]++):(Ne[n]=1,Object.keys(Ne).length>1&&e.warn(222,["an instance of the Split factory"])))}(v,t.core.authorizationKey);var y=Er(v,n.EventEmitter,t.startup.readyTimeout),b=y.readinessManager,S=r({impressionsQueueSize:t.scheduler.impressionsQueueSize,eventsQueueSize:t.scheduler.eventsQueueSize,optimize:Qn(t),matchingKey:ht(t.core.key),splitFiltersValidation:t.sync.__splitFiltersValidation,mode:t.mode,onReadyCb:function(e){e||(b.splits.emit(oe),b.segments.emit(ue))},metadata:Or(t),log:v}),T=g&&g({settings:t,storage:S}),E=p&&p(),w=function(e,t,n,r,i,s){var a=e.log,u=e.impressionListener,c=e.runtime,l=c.ip,f=c.hostname,h=e.version;return{track:function(c,p){if(e.userConsent!==A){var g=c.length,d=[];c.forEach((function(e){r&&(e.pt=r.testAndSet(e));var t=Date.now();i&&i.track(e.feature,t,1),(!i||!e.pt||e.pt<It(t))&&d.push(e)}));var m=t.track(d);if(Zt(m)?m.then((function(){a.info(121,[g])})).catch((function(e){a.error(307,[g,e])})):s&&(s.recordImpressionStats(0,d.length),s.recordImpressionStats(2,c.length-d.length)),u||n)for(var v=function(e){var t={impression:o({},c[e]),attributes:p,ip:l,hostname:f,sdkLanguageVersion:h};setTimeout((function(){n&&n.handleImpression(t);try{u&&u.logImpression(t)}catch(e){a.error(308,[e])}}),0)},y=0;y<g;y++)v(y)}}}}(t,S.impressions,T,E,S.impressionCounts,S.telemetry),_=function(e,t,n,r){var i=e.log,s=Vn(e);function a(e,t){var r='event of type "'+e.eventTypeId+'" for traffic type "'+e.trafficTypeName+'". Key: '+e.key+". Value: "+e.value+". Timestamp: "+e.timestamp+". "+(e.properties?"With properties.":"With no properties.");return t?(i.info(120,[r]),n&&setTimeout((function(){var t=o({},e);e.properties&&(t.properties=o({},e.properties)),n.handleEvent(t)}),0)):i.error(309,[r]),t}return{track:function(n,i){if(e.userConsent===A)return!s&&Promise.resolve(!1);var o=t.track(n,i);return Zt(o)?o.then(a.bind(null,n)):(r&&r.recordEventStats(o?0:1,1),a(n,o))}}}(t,S.events,T,S.telemetry),k=function(e,t){if(e&&t){var n=Oe(t);return{trackEval:function(n){var r=Oe(t);return function(t){switch(t){case nn:return void e.recordException(n);case tn:e.recordNonReadyUsage&&e.recordNonReadyUsage()}e.recordLatency(n,r())}},trackHttp:function(n){var r=Oe(t);return function(t){e.recordHttpLatency(n,r()),t&&t.statusCode?e.recordHttpError(n,t.statusCode):e.recordSuccessfulSync(n,Date.now())}},sessionLength:function(){e.recordSessionLength&&e.recordSessionLength(n())},streamingEvent:function(t,n){80===t?e.recordAuthRejections():(e.recordStreamingEvents({e:t,d:n,t:Date.now()}),50===t&&e.recordTokenRefreshes())}}}var r=function(){return function(){}};return{trackEval:r,trackHttp:r,sessionLength:function(){},streamingEvent:function(){}}}(S.telemetry,n.now),R=i&&i(t,n,k),C={splitApi:R,eventTracker:_,impressionsTracker:w,telemetryTracker:k,sdkReadinessManager:y,readiness:b,settings:t,storage:S,platform:n},N=a&&a(C);C.syncManager=N;var O=h&&new h(N,t,S,R);C.signalListener=O;var I=m(C),L=d(v,S.splits,y);return N&&N.start(),O&&O.start(),v.info(105),o({client:I,manager:function(){return v.debug(29),L},Logger:Nr(t.log),settings:t},s&&s(C))}var Lr={GRANTED:C,DECLINED:A,UNKNOWN:N};function Dr(e){var t=e.settings,n=e.settings.log,r=e.syncManager,i=e.storage,s=i.events,o=i.impressions,a=i.impressionCounts;return Ve(t)||n.info(124,[t.userConsent]),{setStatus:function(e){var i,u;if(!H(e))return n.warn(325,["UserConsent.setStatus"]),!1;var c=e?C:A;return t.userConsent!==c?(n.info(122,[t.userConsent,c]),t.userConsent=c,e?null===(i=null==r?void 0:r.submitterManager)||void 0===i||i.start():(null===(u=null==r?void 0:r.submitterManager)||void 0===u||u.stop(!0),s.clear&&s.clear(),o.clear&&o.clear(),a&&a.clear())):n.info(123,[c]),!0},getStatus:function(){return t.userConsent},Status:Lr}}var Mr=!("undefined"==typeof process||void 0===process.version||!process.version),xr="Split SDK is ready",Fr=[[300,"engine:combiner: Invalid Split, no valid rules found"],[301,"logger: Invalid Log Level - No changes to the logs will be applied."],[303,"The SDK will not get ready. Reason: %s"],[307,"impressions-tracker: Could not store impressions bulk with %s impression(s). Error: %s"],[308,"impressions-tracker: Impression listener logImpression method threw: %s."],[309,"events-tracker: Failed to queue %s"],[304,"sync:offline: There was an issue loading the mock Splits data, no changes will be applied to the current cache. %s"],[305,"sync:streaming: Failed to connect or error on streaming connection, with error message: %s"],[306,"sync:streaming: Failed to authenticate for streaming. Error: %s."],[322,"Response status is not OK. Status: %s. URL: %s. Message: %s"],[302,"A listener was added for %s on the SDK, which has already fired and won't be emitted again. The callback won't be executed."],[314,"%s: Client has already been destroyed - no calls possible."],[310,'%s: you passed "%s", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'],[311,"%s: %s must be a plain object."],[312,"%s: the maximum size allowed for the properties is 32768 bytes, which was exceeded. Event not queued."],[313,"%s: value must be a finite number."],[u,"%s: you passed a null or undefined %s. It must be a non-empty string."],[316,"%s: %s too long. It must have 250 characters or less."],[317,"%s: Key must be an object with bucketingKey and matchingKey with valid string properties."],[c,"%s: you passed an invalid %s. It must be a non-empty string."],[l,"%s: you passed an empty %s. It must be a non-empty string."],[320,"%s: %s must be a non-empty array."],[325,"%s: provided param must be a boolean value."],[321,'settings: you passed an invalid "%s" config param. It should be one of the following values: %s. Defaulting to "%s".'],[323,'settings: an invalid value was received for "sync.localhostMode" config. A valid entity should be provided for localhost mode.'],[324,"settings: the provided storage is invalid.%s Falling back into default MEMORY storage"],[326,'settings: the provided "%s" config param is lower than allowed. Setting to the minimum value %s seconds']].concat([[200,"engine:value: Value %s doesn't match with expected type."],[201,"engine:value: Defined attribute [%s], no attributes received."],[204,"sync:my-segments: Retrying download of segments #%s. Reason: %s"],[205,"sync:split-changes: Error while doing fetch of Splits. %s"],[206,"sync:streaming: Error parsing SSE error notification: %s"],[207,"sync:streaming: Error parsing SSE message notification: %s"],[208,"sync:streaming: Falling back to polling mode. Reason: %s"],[209,"sync:submitter: Dropping %s after retry. Reason: %s."],[210,"sync:submitter: Failed to push %s, keeping data to retry on next iteration. Reason: %s."],[203,"%s: the SDK is not ready, results may be incorrect. Make sure to wait for SDK readiness before using this method."],[202,"No listeners for SDK Readiness detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet ready."],[211,'%s: Property "%s" is of invalid type. Setting value to null.'],[212,"%s: Event has more than 300 properties. Some of them will be trimmed when processed."],[213,'%s: %s "%s" is not of type string, converting.'],[214,'%s: %s "%s" has extra whitespace, trimming.'],[215,'%s: split "%s" does not exist in this environment, please double check what splits exist in the Split web console.'],[216,"%s: traffic_type_name should be all lowercase - converting string to lowercase."],[217,'%s: traffic type "%s" does not have any corresponding split in this environment, make sure you\'re tracking your events to a valid traffic type defined in the Split web console.'],[218,"settings: %s integration item(s) at settings is invalid. %s"],[219,'settings: split filters have been configured but will have no effect if mode is not "%s", since synchronization is being deferred to an external tool.'],[220,'settings: split filter at position %s is invalid. It must be an object with a valid filter type ("byName" or "byPrefix") and a list of "values".'],[221,"settings: splitFilters configuration must be a non-empty array of filter objects."],[222,"settings: You already have %s. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application"],[a,"sync:streaming: Fetching MySegments due to an error processing %s notification: %s"]]).concat([[100,xr+" from cache"],[101,xr],[102,"impressions-tracker: Split: %s. Key: %s. Evaluation: %s. Label: %s"],[103,"impressions-tracker: Queueing corresponding impression."],[104,"New shared client instance created."],[105,"New Split SDK instance created."],[120,"events-tracker: Successfully queued %s"],[121,"impressions-tracker: Successfully stored %s impression(s)."],[122,"UserConsent: consent status changed from %s to %s."],[123,"UserConsent: call had no effect because it was the current consent status (%s)."],[124,"Starting the SDK with %s user consent. No data will be sent."],[106,"sync:polling-manager: Turning segments data polling %s."],[107,"sync:polling-manager: Starting polling"],[108,"sync:polling-manager: Stopping polling"],[109,"sync:split-changes: Retrying download of splits #%s. Reason: %s"],[115,"sync:submitter: Flushing full %s queue and reseting timer."],[116,"sync:submitter: Pushing %s."],[110,"sync:streaming: Refreshing streaming token in %s seconds, and connecting streaming in %s seconds."],[111,"sync:streaming: Attempting to reconnect streaming in %s seconds."],[112,"sync:streaming: Connecting streaming."],[113,"sync:streaming: Streaming is disabled for given Api key. Switching to polling mode."],[114,"sync:streaming: Disconnecting streaming."],[117,"sync:sync-manager: Streaming not available. Starting polling."],[118,"sync:sync-manager: Streaming couldn't connect. Continue polling."],[119,"sync:sync-manager: Streaming connected. Syncing and stopping polling."]]).concat([[0,"engine:combiner: [andCombiner] evaluates to %s"],[1,"engine:combiner: Treatment found: %s"],[2,"engine:combiner: All predicates evaluated, no treatment found."],[3,'engine: using algo "murmur" bucket %s for key %s using seed %s - treatment %s'],[4,"engine:matcher: [allMatcher] is always true"],[5,"engine:matcher: [betweenMatcher] is %s between %s and %s? %s"],[6,"engine:matcher: [booleanMatcher] %s === %s"],[7,"engine:matcher: [containsAllMatcher] %s contains all elements of %s? %s"],[8,"engine:matcher: [containsAnyMatcher] %s contains at least an element of %s? %s"],[9,"engine:matcher: [containsStringMatcher] %s contains %s? %s"],[10,'engine:matcher: [dependencyMatcher] parent split "%s" evaluated to "%s" with label "%s". %s evaluated treatment is part of [%s] ? %s.'],[11,'engine:matcher: [dependencyMatcher] will evaluate parent split: "%s" with key: %s %s'],[12,"engine:matcher: [equalToMatcher] is %s equal to %s? %s"],[13,"engine:matcher: [equalToSetMatcher] is %s equal to set %s? %s"],[14,"engine:matcher: [endsWithMatcher] %s ends with %s? %s"],[15,"engine:matcher: [greaterThanEqualMatcher] is %s greater than %s? %s"],[16,"engine:matcher: [lessThanEqualMatcher] is %s less than %s? %s"],[17,"engine:matcher: [partOfMatcher] %s is part of %s? %s"],[18,"engine:matcher: [segmentMatcher] evaluated %s / %s => %s"],[19,"engine:matcher: [stringMatcher] does %s matches with %s? %s"],[20,"engine:matcher: [stringMatcher] %s is an invalid regex"],[21,"engine:matcher: [startsWithMatcher] %s starts with %s? %s"],[22,"engine:matcher: [whitelistMatcher] evaluated %s in [%s] => %s"],[23,"engine:value: Extracted attribute [%s], [%s] will be used for matching."],[24,"engine:sanitize: Attempted to sanitize [%s] which should be of type [%s]. Sanitized and processed value => [%s]"],[25,"cleanup: Registering cleanup handler %s"],[26,"cleanup: Deregistering cleanup handler %s"],[27,"Retrieving default SDK client."],[28,"Retrieving existing SDK client."],[29,"Retrieving manager instance."],[30,"sync:offline: Splits data: \n%s"],[31,"sync:split-changes: Spin up split update using since = %s"],[32,"sync:split-changes: New splits %s"],[33,"sync:split-changes: Removed splits %s"],[34,"sync:split-changes: Segment names collected %s"],[35,"sync:streaming: New SSE message received, with data: %s."],[36,"sync: Starting %s. Running each %s millis"],[37,"sync: Running %s"],[38,"sync: Stopping %s"],[39,'settings: splits filtering criteria is "%s".']]),Kr=new er(Fr),Pr=String(Mr?process.env.SPLITIO_DEBUG:Ft()?localStorage.getItem("splitio_debug"):""),Ur=wr.NONE;function jr(e){var t=e.treatment;return e.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:Y(e.keys)?[e.keys]:e.keys}}]},partitions:[{treatment:t,size:100}],label:"whitelisted "+t}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:t,size:100}],label:"default rule"}}function Br(){return Promise.resolve()}/^(enabled?|on)/i.test(Pr)?Ur=wr.DEBUG:kr(Pr)&&(Ur=Pr);var Gr,zr=(Gr=function(){var e={emptyMock:"1"};return function(t){var n,r,i=t.features||{};if(n=i,!((r=Object.keys(n)).length!==Object.keys(e).length?(e=n,1):r.some((function(t){var r,i,s=!e[t],o=typeof(r=e[t])!=typeof(i=n[t])||("string"==typeof r?r!==i:r.treatment!==i.treatment||r.config!==i.config),a=s||o;return a&&(e=n),a}))))return!1;var s={};return z(i,(function(e,t){var n=e,r=null;V(e)&&(n=e.treatment,r=e.config||r);var i={};null!==r&&(i[n]=r),s[t]={trafficTypeName:"localhost",conditions:[jr({treatment:n})],configurations:i}})),s}},function(e){var t=e.settings,n=e.readiness,r=e.storage;return o(function(e,t,n,r){return D(r.log,function(e,t,n,r){var i=r.log,s=t.splits,o=!0;return function(){var t=[],a=null,u={};try{u=e(r)}catch(e){a=e,i.error(304,[e])}return!a&&u?(i.debug(30,[JSON.stringify(u)]),z(u,(function(e,n){t.push([n,JSON.stringify({name:n,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:p,conditions:e.conditions||[],configurations:e.configurations,trafficTypeName:e.trafficTypeName})])})),Promise.all([s.clear(),s.addSplits(t)]).then((function(){return n.splits.emit(oe),o&&(o=!1,Promise.resolve(s.checkCache()).then((function(e){e&&n.splits.emit(ae),n.segments.emit(ue)}))),!0}))):Promise.resolve(!0)}}(e,t,n,r),r.scheduler.offlineRefreshRate,"offlineUpdater")}(Gr(),r,n,t),{flush:Br,shared:function(e,t){return{start:function(){setTimeout((function(){t.segments.emit(ue)}),0)},stop:function(){},isRunning:function(){return!0},flush:Br}}})});zr.type="LocalhostFromObject";var qr=[A,C,N],Hr="LOCALSTORAGE";function Wr(e,t){return void 0===t&&(t=[]),function(e,n,r){var i=e.integrations,s=e.log;if(!Array.isArray(i)||0===i.length)return[];var o=i.filter((function(e){return e&&Y(e.type)&&t.indexOf(e.type)>-1})),a=i.length-o.length;return a&&s.warn(218,[a,'Integration items must have a valid "type" value']),o}(e)}var Qr,Vr={defaults:{startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10},userConsent:C,version:"javascript-10.21.1"},acceptKey:!0,acceptTT:!0,runtime:function(){return{ip:!1,hostname:!1}},storage:function(e){var t,n=e.log,r=e.mode,i=e.storage,s=void 0===i?{type:k}:i,o=s.type,a=s.options,u=void 0===a?{}:a,c=s.prefix,l=function(){t=o,o=k};return r===S&&o===Hr&&l(),(o!==k&&o!==Hr||o===Hr&&!Ft())&&(l(),n.error("Invalid or unavailable storage. Fallbacking into MEMORY storage")),{type:o,options:u,prefix:c,__originalType:t}},integrations:function(e){return Wr(e,[Ht,Wt])},logger:function(e){var t,n=e.debug,r=void 0!==n?"boolean"==typeof(t=n)?t?wr.DEBUG:wr.NONE:"string"==typeof t&&kr(t)?t:void 0:Ur,i=new Ar({logLevel:r||Ur},Kr);return r||i._log(wr.ERROR,"Invalid Log Level - No changes to the logs will be applied."),i},localhost:function(){return zr},consent:function(e){var t=e.userConsent,n=e.log;return t=J(t),qr.indexOf(t)>-1?t:(n.error(321,["userConsent",qr,C]),C)}},Yr="object"==typeof Reflect?Reflect:null,Jr=Yr&&"function"==typeof Yr.apply?Yr.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};Qr=Yr&&"function"==typeof Yr.ownKeys?Yr.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var Zr=Number.isNaN||function(e){return e!=e};function $r(){$r.init.call(this)}$r.prototype._events=void 0,$r.prototype._eventsCount=0,$r.prototype._maxListeners=void 0;var Xr=10;function ei(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function ti(e){return void 0===e._maxListeners?$r.defaultMaxListeners:e._maxListeners}function ni(e,t,n,r){var i,s,o,a;if(ei(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=ti(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function ri(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ii(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=ri.bind(r);return i.listener=n,r.wrapFn=i,i}function si(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):ai(i,i.length)}function oi(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function ai(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function ui(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,s=[],o=[],a={},u=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return s},entries:function(){return o},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var c in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){s.push(t=t.toLowerCase()),o.push([t,n]),a[t]=a[t]?a[t]+","+n:n})),n(u())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body||null)}))}Object.defineProperty($r,"defaultMaxListeners",{enumerable:!0,get:function(){return Xr},set:function(e){if("number"!=typeof e||e<0||Zr(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Xr=e}}),$r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},$r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||Zr(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},$r.prototype.getMaxListeners=function(){return ti(this)},$r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)Jr(a,this,t);else{var u=a.length,c=ai(a,u);for(n=0;n<u;++n)Jr(c[n],this,t)}return!0},$r.prototype.addListener=function(e,t){return ni(this,e,t,!1)},$r.prototype.on=$r.prototype.addListener,$r.prototype.prependListener=function(e,t){return ni(this,e,t,!0)},$r.prototype.once=function(e,t){return ei(t),this.on(e,ii(this,e,t)),this},$r.prototype.prependOnceListener=function(e,t){return ei(t),this.prependListener(e,ii(this,e,t)),this},$r.prototype.removeListener=function(e,t){var n,r,i,s,o;if(ei(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},$r.prototype.off=$r.prototype.removeListener,$r.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},$r.prototype.listeners=function(e){return si(this,e,!0)},$r.prototype.rawListeners=function(e){return si(this,e,!1)},$r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):oi.call(e,t)},$r.prototype.listenerCount=oi,$r.prototype.eventNames=function(){return this._eventsCount>0?Qr(this._events):[]};var ci,li,fi="visibilitychange",hi="pagehide",pi="unload",gi="for unload page event.",di=function(){function e(e,t,n,r){this.syncManager=e,this.settings=t,this.storage=n,this.serviceApi=r,this.flushData=this.flushData.bind(this),this.flushDataIfHidden=this.flushDataIfHidden.bind(this),this.stopSync=this.stopSync.bind(this),this.fromImpressionsCollector=re.bind(void 0,t.core.labelsEnabled)}return e.prototype.start=function(){this.settings.log.debug(25,[gi]),"undefined"!=typeof document&&document.addEventListener&&document.addEventListener(fi,this.flushDataIfHidden),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener(hi,this.flushData),window.addEventListener(pi,this.stopSync))},e.prototype.stop=function(){this.settings.log.debug(26,[gi]),"undefined"!=typeof document&&document.removeEventListener&&document.removeEventListener(fi,this.flushDataIfHidden),"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener(hi,this.flushData),window.removeEventListener(pi,this.stopSync))},e.prototype.stopSync=function(){this.syncManager&&this.syncManager.pushManager&&this.syncManager.pushManager.stop()},e.prototype.flushData=function(){if(this.syncManager){if(Ve(this.settings)){var e=this.settings.urls.events,t={sim:this.settings.sync.impressionsMode===b?b:y};this._flushData(e+"/testImpressions/beacon",this.storage.impressions,this.serviceApi.postTestImpressionsBulk,this.fromImpressionsCollector,t),this._flushData(e+"/events/beacon",this.storage.events,this.serviceApi.postEventsBulk),this.storage.impressionCounts&&this._flushData(e+"/testImpressions/count/beacon",this.storage.impressionCounts,this.serviceApi.postTestImpressionsCount,se)}if(this.storage.telemetry){var n=this.settings.urls.telemetry,r=Ie(this.storage.telemetry,this.storage.splits,this.storage.segments);this._flushData(n+"/v1/metrics/usage/beacon",r,this.serviceApi.postMetricsUsage)}}},e.prototype.flushDataIfHidden=function(){"hidden"===document.visibilityState&&this.flushData()},e.prototype._flushData=function(e,t,n,r,i){if(!t.isEmpty()){var s=r?r(t.pop()):t.pop();this._sendBeacon(e,s,i)||n(JSON.stringify(s)).catch((function(){})),t.clear()}},e.prototype._sendBeacon=function(e,t,n){if("undefined"!=typeof navigator&&navigator.sendBeacon){var r={entries:t,token:this.settings.core.authorizationKey,sdk:this.settings.version};n&&o(r,n);var i=JSON.stringify(r);return navigator.sendBeacon(e,i)}return!1},e}(),mi={getFetch:function(){return"function"==typeof fetch?fetch:ui},getEventSource:function(){return"function"==typeof EventSource?EventSource:void 0},EventEmitter:$r,now:"object"==typeof performance&&"function"==typeof performance.now?performance.now.bind(performance):Date.now},vi=di,yi=(ci=function(e){var t=e.splitApi,n=e.storage,r=e.readiness,i=e.settings,s=i.log,o=function(e,t,n,r,i){return D(r.log,Nt(r.log,function(e){return function(t,n,r,i){var s=e(t,n,r);return i&&(s=i(s)),s.then((function(e){return e.json()}))}}(e),t.splits,t.segments,n.splits,r.startup.requestTimeoutBeforeReady,r.startup.retriesOnFailureBeforeReady,!0),r.scheduler.featuresRefreshRate,"splitChangesUpdater")}(t.fetchSplitChanges,n,r,i),a={},u=f(ht(i.core.key),r,n);function c(){z(a,(function(e){e.start()}))}function l(){z(a,(function(e){e.isRunning()&&e.stop()}))}function f(e,n,r){var s=function(e,t,n,r,i){return D(r.log,At(r.log,function(e){return function(t,n,r){var i=e(t,n);return r&&(i=r(i)),i.then((function(e){return e.json()})).then((function(e){return e.mySegments.map((function(e){return e.name}))}))}}(e),t.splits,t.segments,n.segments,r.startup.requestTimeoutBeforeReady,r.startup.retriesOnFailureBeforeReady,i),r.scheduler.segmentsRefreshRate,"mySegmentsUpdater")}(t.fetchMySegments,r,n,i,e);function o(){n.isReady()||r.splits.usesSegments()||n.segments.emit(ue)}return r.splits.usesSegments()?n.splits.once(oe,o):setTimeout(o,0),a[e]=s,s}return r.splits.on(oe,(function(){if(o.isRunning()){var e=n.splits.usesSegments();e!==u.isRunning()&&(s.info(106,[e?"ON":"OFF"]),e?c():l())}})),{splitsSyncTask:o,segmentsSyncTask:u,start:function(){s.info(107),o.start(),n.splits.usesSegments()&&c()},stop:function(){s.info(108),o.isRunning()&&o.stop(),l()},isRunning:o.isRunning,syncAll:function(){var e=[o.execute()];return z(a,(function(t){e.push(t.execute())})),Promise.all(e)},add:f,remove:function(e){delete a[e]},get:function(e){return a[e]}}},li=function(e,t){var n,r=e.settings,i=e.storage,s=e.splitApi,u=e.readiness,c=e.platform,l=e.telemetryTracker,f=r.core.key?ht(r.core.key):void 0,h=r.log;try{n=new ft(r,!f,c.getEventSource)}catch(e){return void h.warn(208,[e])}var p,g=(p=s.fetchAuth,function(e){return p(e).then((function(e){return e.json()})).then((function(e){if(e.token){var t=(r=e.token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(et(r).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")),JSON.parse(i));if("number"!=typeof t.iat||"number"!=typeof t.exp)throw new Error('token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid');var n=JSON.parse(t["x-ably-capability"]);return o({decodedToken:t,channels:n},e)}var r,i;return e}))}),d=new c.EventEmitter,m=function(e,t,n){var r=function(e,t){var n=Je.map((function(e){return{regex:e,hasPublishers:!0,oTime:-1,cTime:-1}})),r=!0,i=!0;return{handleOpen:function(){t.streamingEvent(0),e.emit(Ue)},isStreamingUp:function(){return i&&r},handleOccupancyEvent:function(s,o,a){for(var u=0;u<n.length;u++){var c=n[u];if(c.regex.test(o)){if(t.streamingEvent(Ze[u],s),a>c.oTime){c.oTime=a,c.hasPublishers=0!==s;var l=n.some((function(e){return e.hasPublishers}));i&&(!l&&r?e.emit(je):l&&!r&&e.emit(Ue)),r=l}return}}},handleControlEvent:function(s,o,a){if(s!==Fe.STREAMING_RESET)for(var u=0;u<n.length;u++){var c=n[u];if(c.regex.test(o))return void(a>c.cTime&&(c.cTime=a,s===Fe.STREAMING_DISABLED?(t.streamingEvent(30,0),e.emit(Ke)):r&&(s===Fe.STREAMING_PAUSED&&i?(t.streamingEvent(30,2),e.emit(je)):s!==Fe.STREAMING_RESUMED||i||(t.streamingEvent(30,1),e.emit(Ue))),i=s===Fe.STREAMING_RESUMED))}else e.emit(s)}}}(t,n);return{handleOpen:function(){r.handleOpen()},handleError:function(r){var i=r;try{i=function(e){return Y(e.data)&&(e.parsedData=JSON.parse(e.data)),e}(r)}catch(t){e.warn(206,[t])}var s=i.parsedData&&i.parsedData.message||i.message;e.error(305,[s]),function(e){if(e.parsedData&&e.parsedData.code){var t=e.parsedData.code;if(n.streamingEvent(60,t),40140<=t&&t<=40149)return!0;if(4e4<=t&&t<=49999)return!1}else n.streamingEvent(40,1);return!0}(i)?t.emit(Pe):t.emit(Ke)},handleMessage:function(n){var i;try{if(i=function(e){if(e.data){var t=JSON.parse(e.data);return t.parsedData=JSON.parse(t.data),t.name&&"[meta]occupancy"===t.name&&(t.parsedData.type=Qe),t}}(n),!i)return}catch(t){return void e.warn(207,[t])}var s=i.parsedData,o=i.data,a=i.channel,u=i.timestamp;if(e.debug(35,[o]),r.isStreamingUp()||-1!==[Qe,We].indexOf(s.type))switch(s.type){case He:case ze:case Ge:case qe:t.emit(s.type,s);break;case Be:t.emit(s.type,s,a);break;case Qe:r.handleOccupancyEvent(s.metrics.publishers,a,u);break;case We:r.handleControlEvent(s.controlType,a,u)}}}}(h,d,l);n.setEventHandler(m);var v,y,b,S,T=f?void 0:function(e,t,n){var r={};return{put:function(i){var s=i.changeNumber,o=i.segmentName;r[o]||(r[o]=function(r){var i,s,o=0,a=!1,u=new Ye(c,1e4,6e4);function c(){i=!0,o>n.getChangeNumber(r)?(a=!1,t.execute(!1,r,!0,s?o:void 0).then((function(){if(i)if(a)c();else{var t=u.attempts+1;if(o<=n.getChangeNumber(r))return e.debug("Refresh completed"+(s?" bypassing the CDN":"")+" in "+t+" attempts."),void(i=!1);if(t<10)return void u.scheduleCall();s?(e.debug("No changes fetched after "+t+" attempts with CDN bypassed."),i=!1):(u.reset(),s=!0,c())}}))):i=!1}return{put:function(e){e<=n.getChangeNumber(r)||e<=o||(o=e,a=!0,s=!1,!u.timeoutID&&i||c(),u.reset())},stop:function(){i=!1,u.reset()}}}(o)),r[o].put(s)},stop:function(){Object.keys(r).forEach((function(e){return r[e].stop()}))}}}(h,t.segmentsSyncTask,i.segments),E=function(e,t,n,r,i){var s,o,a=0,u=!1,c=new Ye(l,1e4,6e4);function l(){s=!0,a>t.getChangeNumber()?(u=!1,n.execute(!0,o?a:void 0).then((function(){if(s)if(u)l();else{i&&i.execute(!0);var n=c.attempts+1;if(a<=t.getChangeNumber())return e.debug("Refresh completed"+(o?" bypassing the CDN":"")+" in "+n+" attempts."),void(s=!1);if(n<10)return void c.scheduleCall();o?(e.debug("No changes fetched after "+n+" attempts with CDN bypassed."),s=!1):(c.reset(),o=!0,l())}}))):s=!1}function f(e){var n=e.changeNumber;n<=t.getChangeNumber()||n<=a||(a=n,u=!0,o=!1,!c.timeoutID&&s||l(),c.reset())}return{put:f,killSplit:function(e){var n=e.changeNumber,i=e.splitName,s=e.defaultTreatment;t.killLocally(i,s,n)&&r.emit(oe,!0),f({changeNumber:n})},stop:function(){s=!1,c.reset()}}}(h,i.splits,t.splitsSyncTask,u.splits,f?void 0:t.segmentsSyncTask),w={},_={},k=!1,R=new Ye(C,r.scheduler.pushRetryBackoffBase);function C(){if(!v){h.info(112),v=!1;var e=f?Object.keys(_):void 0;g(e).then((function(t){if(!v)return t.pushEnabled?void(e&&e.length<Object.keys(_).length||function(e){b&&clearTimeout(b),S&&clearTimeout(S);var t=e.decodedToken,r=t.exp-t.iat-600,i="number"==typeof e.connDelay&&e.connDelay>=0?e.connDelay:60;h.info(110,[r,i]),b=setTimeout(C,1e3*r),S=setTimeout((function(){v||n.open(e)}),1e3*i),l.streamingEvent(50,t.exp)}(t)):(h.info(113),void d.emit(Ke))})).catch((function(e){if(!v){if(h.error(306,[e.message]),e.statusCode>=400&&e.statusCode<500)return l.streamingEvent(80),void d.emit(Ke);d.emit(Pe)}}))}}function A(){v||(v=!0,n.close(),h.info(114),b&&clearTimeout(b),S&&clearTimeout(S),R.reset(),N())}function N(){E.stop(),f?z(_,(function(e){return e.worker.stop()})):T.stop()}return d.on(je,N),d.on(Ue,(function(){R.reset()})),d.on(Ke,(function(){y=!0,A(),d.emit(je)})),d.on(Pe,(function(){n.close();var e=R.scheduleCall();h.info(111,[e/1e3]),d.emit(je)})),d.on(Fe.STREAMING_RESET,(function(){v||(b&&clearTimeout(b),C())})),d.on(qe,E.killSplit),d.on(He,E.put),f?(d.on(Be,(function(e,t){var n=t.split("_")[2],r=w[n];r&&_[r]&&_[r].worker.put(e.changeNumber,e.includesPayload?e.segmentList?e.segmentList:[]:void 0)})),d.on(Ge,(function(e){switch(e.u){case ct.BoundedFetchRequest:var t;try{s=e.d,o=e.c,t=dt(s,o)}catch(e){h.warn(a,["BoundedFetchRequest",e]);break}return void z(_,(function(n){var r,i,s,o,a=n.hash64,u=n.worker;r=t,i=a.hex,o=(s=parseInt(i.slice(8),16)%(8*r.length))%8,(r[Math.floor(s/8)]&1<<o)>0&&u.put(e.changeNumber)}));case ct.KeyList:var n,r,i=void 0;try{i=function(e,t){var n,r=(n=dt(e,t),String.fromCharCode.apply(null,n));return JSON.parse(r.replace(/\d+/g,'"$&"'))}(e.d,e.c),n=new yt(i.a),r=new yt(i.r)}catch(e){h.warn(a,["KeyList",e]);break}return void z(_,(function(t){var i=t.hash64,s=t.worker,o=!!n.has(i.dec)||!r.has(i.dec)&&void 0;void 0!==o&&s.put(e.changeNumber,{name:e.segmentName,add:o})}));case ct.SegmentRemoval:if(!e.segmentName){h.warn(a,["SegmentRemoval","No segment name was provided"]);break}return void z(_,(function(t){return t.worker.put(e.changeNumber,{name:e.segmentName,add:!1})}))}var s,o;z(_,(function(t){t.worker.put(e.changeNumber)}))}))):d.on(ze,T.put),o(Object.create(d),{stop:function(){A(),f&&this.remove(f)},start:function(){y||!1===v||(v=!1,f?this.add(f,t.segmentsSyncTask):setTimeout(C))},isRunning:function(){return!1===v},add:function(e,t){var n,r,i=at(e);w[i]||(w[i]=e,_[e]={hash64:(n=e,r=kt(n).slice(0,16),{hex:r,dec:Rt(r)}),worker:$e(t)},k=!0,setTimeout((function(){k&&(k=!1,C())}),0))},remove:function(e){var t=at(e);delete w[t],delete _[e]}})},function(e){var t=e.settings,n=e.settings,r=n.log,i=n.streamingEnabled,s=n.sync.enabled,o=e.telemetryTracker,a=ci&&ci(e),u=s&&i&&a&&li?li(e,a):void 0,c=xe(e);u&&(u.on(Ue,(function(){r.info(119),a.isRunning()&&(a.stop(),o.streamingEvent(70,0)),a.syncAll()})),u.on(je,(function(){a.isRunning()?r.info(118):(r.info(117),a.start(),o.streamingEvent(70,1))})));var l=!1,f=!0;return{pollingManager:a,pushManager:u,submitterManager:c,start:function(){l=!0,a&&(s?u?(f&&(a.syncAll(),f=!1),u.start()):a.start():f&&(a.syncAll(),f=!1)),c.start(!Ve(t))},stop:function(){l=!1,u&&u.stop(),a&&a.isRunning()&&a.stop(),c.stop()},isRunning:function(){return l},flush:function(){return c.execute(!Ve(t))},shared:function(e,t,n){if(a){var r=a.add(e,t,n);return{isRunning:r.isRunning,start:function(){s?u?(a.isRunning()?n.splits.usesSegments()&&r.start():r.execute(),u.add(e,r)):n.splits.usesSegments()&&r.start():t.isReady()||r.execute()},stop:function(){var t=a.get(e);t&&(u&&u.remove(e),t.isRunning()&&t.stop(),a.remove(e))},flush:function(){return Promise.resolve()}}}}}});function bi(e){return e.storage.type===R?function(e){void 0===e&&(e={});var t=function(e){return e?e+".SPLITIO":"SPLITIO"}(e.prefix);function n(e){if(!Ft())return e.log.warn(Ut+"LocalStorage API is unavailable. Falling back to default MEMORY storage"),Jt(e);var n=e.log,r=new xt(t,e.matchingKey),i=Date.now()-864e6;return{splits:new jt(n,r,i,e.splitFiltersValidation),segments:new Gt(n,r),impressions:new Ot(e.impressionsQueueSize),impressionCounts:e.optimize?new Lt:void 0,events:new Dt(e.eventsQueueSize),telemetry:e.mode!==S&&Vt()?new Yt:void 0,destroy:function(){this.splits=new qt,this.segments=new zt,this.impressions.clear(),this.impressionCounts&&this.impressionCounts.clear(),this.events.clear()},shared:function(e){var r=new xt(t,e);return{splits:this.splits,segments:new Gt(n,r),impressions:this.impressions,impressionCounts:this.impressionCounts,events:this.events,telemetry:this.telemetry,destroy:function(){this.splits=new qt,this.segments=new zt}}}}}return n.type=R,n}(e.storage):e.storage.__originalType===R?br:Jt}var Si=function(e,t){var n=function(e){return _e(e,Vr)}(e),r=function(e){var t={settings:e,platform:mi,storageFactory:bi(e),splitApiFactory:L,syncManagerFactory:yi,sdkManagerFactory:un,sdkClientMethodFactory:$n,SignalListener:vi,integrationsManagerFactory:e.integrations&&e.integrations.length>0?yr.bind(null,e.integrations):void 0,impressionsObserverFactory:Wn(e)?or:void 0,extraProps:function(e){return{UserConsent:Dr(e)}}};return e.mode===S&&(t.splitApiFactory=void 0,t.syncManagerFactory=e.sync.localhostMode,t.SignalListener=void 0),t}(n);return t&&t(r),Ir(r)};return t.default}()}));